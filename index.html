<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Stars Î∂ÑÏÑù & ÌôúÏö© Í∞ÄÏù¥Îìú</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        /* Graph View */
        .graph-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: #FAFAFA;
            display: none;
            margin-top: 20px;
        }

        .graph-container.show {
            display: block;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .view-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .view-btn.active {
            background: #764ba2;
            color: white;
            border-color: #764ba2;
        }

        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: #f5f5f5;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            transition: all 0.2s;
            z-index: 10;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Search Form */
        .search-form {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
        }

        .search-input-wrap {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 12px;
            outline: none;
        }

        .search-input:focus {
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.3);
        }

        .search-btn {
            padding: 16px 30px;
            background: white;
            color: #764ba2;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .search-btn:hover {
            background: #f0f0f0;
        }

        .error-msg {
            color: #ffcccc;
            margin-top: 10px;
            display: none;
        }

        .error-msg.show {
            display: block;
        }

        /* Stats */
        .stats-section {
            background: white;
            padding: 30px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .stats-section.show {
            display: block;
        }

        .stats-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-item {
            text-align: center;
            padding: 15px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .stat-value.purple {
            color: #764ba2;
        }

        .stat-value.blue {
            color: #3b82f6;
        }

        .stat-value.green {
            color: #22c55e;
        }

        .stat-value.orange {
            color: #f97316;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Filter */
        .filter-section {
            background: #eee;
            padding: 20px;
            display: none;
        }

        .filter-section.show {
            display: block;
        }

        .filter-wrap {
            max-width: 1200px;
            margin: 0 auto;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }

        .filter-input:focus {
            border-color: #764ba2;
        }

        .sort-select {
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            background: white;
        }

        /* Category Chips */
        .category-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid #ddd;
            background: white;
            color: #555;
            transition: all 0.2s;
        }

        .chip:hover {
            transform: scale(1.05);
        }

        .chip.active {
            background: #764ba2;
            color: white;
            border-color: #764ba2;
        }

        /* Collections Bar (Polished) */
        .collections-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #e0e0e0;
            margin-bottom: 20px;
            align-items: center;
        }

        .collection-btn {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            background: #fff;
            border-radius: 20px;
            font-size: 0.95rem;
            cursor: pointer;
            color: #555;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .collection-btn:hover {
            background: #f8f9fa;
            border-color: #ccc;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .collection-btn.active {
            background: #fff8e1;
            /* Amber-50 */
            border-color: #ffc107;
            color: #b45309;
            /* Amber-700 */
            font-weight: 600;
            box-shadow: 0 0 0 1px #ffc107;
        }

        .collection-btn.add-coll {
            border: 1px dashed #9ca3af;
            color: #6b7280;
            background: transparent;
            box-shadow: none;
        }

        .collection-btn.add-coll:hover {
            border-color: #4b5563;
            background: #f3f4f6;
            color: #1f2937;
        }

        /* Main Content */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Loading */
        .loading-state {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .loading-state.show {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #eee;
            border-top-color: #764ba2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #888;
        }

        .empty-state.hide {
            display: none;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state h2 {
            font-size: 1.5rem;
            color: #555;
            margin-bottom: 10px;
        }

        /* Repos Grid */
        .repos-grid {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .repos-grid.show {
            display: grid;
        }

        @media (max-width: 1024px) {
            .repos-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .repos-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Repo Card */
        .repo-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s;
        }

        .repo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }

        .repo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .repo-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            margin-right: 10px;
        }

        .repo-stars {
            color: #f59e0b;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .repo-desc {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.5;
        }

        .repo-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .language-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #666;
        }

        .language-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .repo-owner {
            font-size: 0.8rem;
            color: #999;
        }

        .repo-category {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .category-tag {
            display: inline-block;
            padding: 4px 10px;
            background: #f3e8ff;
            color: #764ba2;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Load More */
        .load-more {
            text-align: center;
            margin-top: 30px;
            display: none;
        }

        .load-more.show {
            display: block;
        }

        /* List View */
        .repos-list {
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .repos-list.show {
            display: flex;
        }

        .repo-list-item {
            background: white;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.2s;
        }

        .repo-list-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        .repo-list-info {
            flex: 1;
            min-width: 0;
            /* for truncation */
        }

        .repo-list-name {
            font-weight: 700;
            color: #333;
            font-size: 1.05rem;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .repo-list-desc {
            color: #666;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .repo-list-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.85rem;
            color: #888;
            flex-shrink: 0;
        }

        /* AI Badge */
        .ai-status-badge {
            font-size: 0.75rem;
            padding: 2px 6px;
            background: #fce7f3;
            color: #db2777;
            border-radius: 4px;
            font-weight: 600;
            align-items: center;
            gap: 4px;
        }

        /* Collection Badges */
        .collection-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: #e0f2fe;
            color: #0369a1;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-right: 5px;
            cursor: pointer;
        }

        .collection-badge:hover {
            background: #bae6fd;
        }

        .remove-x {
            font-weight: bold;
            color: #0ea5e9;
            cursor: pointer;
            padding: 0 2px;
        }

        .remove-x:hover {
            color: #0284c7;
        }

        /* --- v2 AI Tech Card Styles --- */
        .repo-card-v2 {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            color: #1f2937;
        }

        .v2-header {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .v2-icon {
            font-size: 2rem;
            background: #f3f4f6;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            flex-shrink: 0;
        }

        .v2-title-area h3 {
            margin: 0 0 4px 0;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .v2-one-liner {
            margin: 0 0 8px 0;
            font-size: 0.95rem;
            color: #4b5563;
            line-height: 1.4;
        }

        .v2-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .v2-tag {
            font-size: 0.75rem;
            padding: 2px 8px;
            background: #e5e7eb;
            color: #374151;
            border-radius: 12px;
            font-weight: 500;
        }

        .v2-section {
            margin-bottom: 24px;
            background: #fff;
            background: #fff;
            padding: 12px 14px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            border-radius: 8px;
        }

        .v2-section h4 {
            margin: 0 0 12px 0;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
            font-weight: 600;
        }

        .v2-section ul {
            margin: 0;
            padding-left: 20px;
            color: #374151;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .v2-why {
            background: #f9fafb;
            border-left: 3px solid #3b82f6;
        }

        .v2-code-block {
            background: #1f2937;
            color: #f3f4f6;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            position: relative;
            overflow-x: auto;
        }

        .v2-copy-btn {
            position: absolute;
            right: 8px;
            top: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .v2-copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Decision Toggle */
        .decision-toggle-group {
            margin-bottom: 24px;
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .decision-label {
            display: block;
            margin-bottom: 12px;
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .toggle-container {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .d-btn {
            border: 1px solid #cbd5e1;
            background: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            color: #475569;
            transition: all 0.2s;
            flex: 1;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .d-btn:hover {
            background: #f1f5f9;
        }

        .d-btn.use_now.active {
            background: #dbeafe;
            border-color: #60a5fa;
            color: #1e40af;
            box-shadow: 0 0 0 2px #bfdbfe;
        }

        .d-btn.integrate.active {
            background: #dcfce7;
            border-color: #4ade80;
            color: #166534;
            box-shadow: 0 0 0 2px #bbf7d0;
        }

        .d-btn.reference.active {
            background: #fef9c3;
            border-color: #facc15;
            color: #854d0e;
            box-shadow: 0 0 0 2px #fef08a;
        }

        .d-btn.archive.active {
            background: #f3f4f6;
            border-color: #9ca3af;
            color: #374151;
            box-shadow: 0 0 0 2px #e5e7eb;
        }

        /* AI Recommendation Badge */
        .v2-recommendation {
            margin-top: 24px;
            padding: 16px;
            border-radius: 8px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .v2-recommendation.adopt {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
        }

        .v2-recommendation.hold {
            background: #fefce8;
            border: 1px solid #fef08a;
        }

        .v2-recommendation.avoid {
            background: #fef2f2;
            border: 1px solid #fecaca;
        }

        .rec-icon {
            font-size: 1.5rem;
            line-height: 1;
        }

        .rec-content strong {
            display: block;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .rec-content p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #334155;
        }

        .v2-grid-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .v2-col {
            padding: 16px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .v2-col.success {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
        }

        .v2-col.danger {
            background: #fef2f2;
            border: 1px solid #fecaca;
        }

        .v2-col h4 {
            margin: 0 0 8px 0;
            font-size: 0.85rem;
        }

        .v2-meta {
            text-align: right;
            font-size: 0.75rem;
            color: #9ca3af;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .load-more-btn {
            padding: 14px 40px;
            background: #764ba2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .load-more-btn:hover {
            background: #5a3a7e;
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-backdrop.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .modal-owner {
            color: #888;
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            padding: 5px;
        }

        .modal-close:hover {
            color: #555;
        }

        .modal-content {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(90vh - 180px);
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: all 0.2s;
        }

        .modal-btn.github {
            background: #333;
            color: white;
        }

        .modal-btn.github:hover {
            background: #111;
        }

        .modal-btn.homepage {
            background: #764ba2;
            color: white;
        }

        .modal-btn.homepage:hover {
            background: #5a3a7e;
        }

        .modal-btn.hide {
            display: none;
        }

        /* Guide Content */
        .guide-category {
            margin-bottom: 24px;
        }

        /* Mobile Optimization */
        @media (max-width: 640px) {
            .header {
                padding: 40px 20px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .header p {
                font-size: 0.95rem;
            }

            .search-form {
                flex-direction: column;
            }

            .search-btn {
                width: 100%;
            }

            .modal-content {
                padding: 16px;
            }

            .modal-header {
                padding: 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .guide-category-tag {
            display: inline-block;
            padding: 6px 14px;
            background: #f3e8ff;
            color: #764ba2;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .guide-section {
            margin-bottom: 24px;
        }

        .guide-section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .guide-section-title .icon {
            font-size: 1rem;
        }

        .guide-section-title .icon.blue {
            color: #3b82f6;
        }

        .guide-section-title .icon.green {
            color: #22c55e;
        }

        .guide-section-title .icon.yellow {
            color: #f59e0b;
        }

        .guide-section-title .icon.purple {
            color: #764ba2;
        }

        .guide-text {
            color: #555;
            line-height: 1.6;
        }

        .guide-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .guide-stat {
            background: #f9f9f9;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .guide-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .guide-stat-value.yellow {
            color: #f59e0b;
        }

        .guide-stat-value.blue {
            color: #3b82f6;
        }

        .guide-stat-value.green {
            color: #22c55e;
        }

        .guide-stat-label {
            font-size: 0.8rem;
            color: #888;
        }

        .guide-code {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }

        .guide-code .comment {
            color: #6a9955;
        }

        .guide-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .guide-topic {
            padding: 6px 12px;
            background: #f0f0f0;
            color: #555;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .guide-usecases {
            list-style: none;
        }

        .guide-usecase {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            color: #555;
        }

        .guide-usecase .check {
            color: #22c55e;
            margin-top: 2px;
        }

        .guide-updated {
            font-size: 0.85rem;
            color: #999;
            padding-top: 16px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Health Badge */
        .health-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .health-badge.active {
            background: #dcfce7;
            color: #166534;
        }

        .health-badge.stable {
            background: #e0f2fe;
            color: #075985;
        }

        .health-badge.stale {
            background: #fee2e2;
            color: #991b1b;
        }

        .health-badge.archived {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #cbd5e1;
        }

        .health-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .health-badge.active .health-dot {
            background: #166534;
        }

        .health-badge.stable .health-dot {
            background: #075985;
        }

        .health-badge.stale .health-dot {
            background: #991b1b;
        }

        .health-badge.archived .health-dot {
            background: #64748b;
        }

        /* User Data Section in Modal */
        .user-data-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }

        .user-data-title {
            font-size: 1rem;
            font-weight: 700;
            color: #475569;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 0.95rem;
            background: white;
            transition: all 0.2s;
        }

        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .save-btn {
            background: #764ba2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            float: right;
        }

        .save-btn:hover {
            background: #5a3a7e;
        }

        /* Tags in Card */
        .purpose-tag {
            display: inline-block;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
            background: #e0e7ff;
            color: #4338ca;
            margin-left: 8px;
            vertical-align: middle;
        }

        /* Spinner for Button */
        .spinner-sm {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 5px;
        }

        .ai-loading {
            text-align: center;
            padding: 20px;
            color: #db2777;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* AI Section in Modal */
        .ai-section {
            margin-top: 20px;
            background: #fdf2f8;
            /* pink-50 */
            border: 1px solid #fbcfe8;
            border-radius: 8px;
            padding: 16px;
        }

        .ai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .ai-title {
            font-weight: 700;
            color: #db2777;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-btn {
            background: #db2777;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .ai-btn:hover {
            background: #be185d;
        }

        .ai-btn:disabled {
            background: #f9a8d4;
            cursor: not-allowed;
        }

        .ai-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #374151;
            white-space: pre-wrap;
        }

        .markdown-prose ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .markdown-prose li {
            margin-bottom: 4px;
        }

        .markdown-prose strong {
            color: #831843;
        }

        /* Improved Markdown Styles */
        .md-h1 {
            font-size: 1.1rem;
            margin: 15px 0 8px 0;
            color: #db2777;
            border-bottom: 2px solid #fce7f3;
            padding-bottom: 4px;
        }

        .md-h2 {
            font-size: 1.0rem;
            margin: 12px 0 6px 0;
            color: #9d174d;
            font-weight: 700;
        }

        .md-h3 {
            font-size: 0.95rem;
            margin: 10px 0 5px 0;
            color: #4b5563;
            font-weight: 700;
        }

        .code-block {
            background: #1e293b;
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
        }

        .code-header {
            background: #334155;
            color: #e2e8f0;
            padding: 4px 12px;
            font-size: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-block pre {
            margin: 0;
            padding: 12px;
            overflow-x: auto;
        }

        .code-block code {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            color: #e2e8f0;
        }

        .copy-btn {
            background: transparent;
            border: 1px solid #64748b;
            color: #cbd5e1;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .copy-btn:hover {
            background: #475569;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <button class="settings-btn" onclick="openSettings()">
                ‚öôÔ∏è API ÏÑ§Ï†ï
            </button>
            <h1>‚≠ê GitHub Stars Î∂ÑÏÑùÍ∏∞</h1>
            <p>Ï¶êÍ≤®Ï∞æÍ∏∞Ìïú Î†àÌè¨ÏßÄÌÜ†Î¶¨Î•º Î∂ÑÏÑùÌïòÍ≥† ÌôúÏö© Î∞©Î≤ïÏùÑ ÏïåÏïÑÎ≥¥ÏÑ∏Ïöî</p>

            <!-- Search Form -->
            <div class="search-form">
                <div class="search-input-wrap">
                    <input type="text" id="usernameInput" placeholder="ÏÇ¨Ïö©ÏûêÎ™Ö ÎòêÎäî GitHub URL (Ïòà: mykim19)"
                        class="search-input" list="historyList" autocomplete="off">
                    <datalist id="historyList"></datalist>
                </div>
                <button id="searchBtn" class="search-btn">
                    üîç Î∂ÑÏÑùÌïòÍ∏∞
                </button>
            </div>
            <p id="errorMsg" class="error-msg"></p>
        </div>
    </header>

    <!-- Stats Section -->
    <section id="statsSection" class="stats-section">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value purple" id="totalStars">0</div>
                <div class="stat-label">Ï¥ù Stars</div>
            </div>
            <div class="stat-item">
                <div class="stat-value blue" id="totalLanguages">0</div>
                <div class="stat-label">ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç Ïñ∏Ïñ¥</div>
            </div>
            <div class="stat-item">
                <div class="stat-value green" id="totalTopics">0</div>
                <div class="stat-label">ÌÜ†ÌîΩ/ÌÉúÍ∑∏</div>
            </div>
            <div class="stat-item">
                <div class="stat-value orange" id="avgStars">0</div>
                <div class="stat-label">ÌèâÍ∑† Stars</div>
            </div>
        </div>
    </section>

    <!-- Filter Section -->
    <section id="filterSection" class="filter-section">
        <div class="filter-wrap">
            <div class="filter-row">
                <input type="text" id="filterInput" placeholder="Î†àÌè¨ÏßÄÌÜ†Î¶¨ Í≤ÄÏÉâ..." class="filter-input">
                <select id="sortSelect" class="sort-select">
                    <option value="starred_at">ÏµúÍ∑º Star Ïàú</option>
                    <option value="stars">Ïù∏Í∏∞Ïàú (Stars)</option>
                    <option value="updated">ÏµúÍ∑º ÏóÖÎç∞Ïù¥Ìä∏ Ïàú</option>
                    <option value="name">Ïù¥Î¶ÑÏàú</option>
                </select>
                <select id="purposeFilter" class="sort-select">
                    <option value="all">Î™®Îì† Î™©Ï†Å</option>
                    <option value="reference">üìö Ï∞∏Í≥†Ïö©</option>
                    <option value="to-try">üß™ Ïç®Î≥º Í≤É</option>
                    <option value="idea">üí° ÏïÑÏù¥ÎîîÏñ¥</option>
                    <option value="alternative">üîÑ ÎåÄÏ≤¥Ïû¨ Ï°∞ÏÇ¨</option>
                    <option value="using">üõ† ÏÇ¨Ïö© Ï§ë</option>
                    <option value="memo">üìù Î©îÎ™® ÏûàÏùå</option>
                </select>
                <select id="decisionFilter" class="sort-select" style="border-color:#cbd5e1; color:#475569;">
                    <option value="all">Î™®Îì† Í≤∞Ï†ï</option>
                    <option value="adopt">‚úÖ Adopt</option>
                    <option value="hold">‚è∏ Hold</option>
                    <option value="avoid">üö´ Avoid</option>
                    <option value="none">ÎØ∏Í≤∞Ï†ï (None)</option>
                </select>
            </div>
            <div id="categoryChips" class="category-chips">
                <button class="chip active" data-category="all">Ï†ÑÏ≤¥</button>
            </div>
            <!-- Collections Bar -->
            <div id="collectionsBar" class="collections-bar" style="display:none;"></div>

            <div class="view-toggle">
                <button class="view-btn active" id="viewGridBtn" onclick="switchView('grid')">‚ñ¶ Í∑∏Î¶¨Îìú</button>
                <button class="view-btn" id="viewListBtn" onclick="switchView('list')">‚ò∞ Î¶¨Ïä§Ìä∏</button>
                <button class="view-btn" id="viewGraphBtn" onclick="switchView('graph')">üï∏Ô∏è Í¥ÄÍ≥ÑÎßù</button>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main">
        <!-- Loading State -->
        <div id="loadingState" class="loading-state">
            <div class="spinner"></div>
            <p>Stars Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state">
            <div class="empty-icon">‚≠ê</div>
            <h2>GitHub StarsÎ•º Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî</h2>
            <p>ÏúÑÏóê GitHub ÏÇ¨Ïö©ÏûêÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÎ©¥ Ï¶êÍ≤®Ï∞æÍ∏∞Ìïú Î†àÌè¨ÏßÄÌÜ†Î¶¨Î•º Î∂ÑÏÑùÌï©ÎãàÎã§</p>
        </div>

        <!-- Repos Grid -->
        <!-- Repos Grid -->
        <div id="reposGrid" class="repos-grid"></div>
        <div id="reposList" class="repos-list"></div>
        <div id="graphContainer" class="graph-container"></div>

        <!-- Load More -->
        <div id="loadMoreSection" class="load-more">
            <button id="loadMoreBtn" class="load-more-btn">+ Îçî Î∂àÎü¨Ïò§Í∏∞</button>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-backdrop">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">‚öôÔ∏è ÏÑ§Ï†ï</div>
                <button id="closeSettings" class="modal-close">‚úï</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label class="form-label">AI Provider ÏÑ†ÌÉù</label>
                    <select id="aiProviderSelect" class="form-select" style="width: 100%; margin-bottom: 15px;"
                        onchange="toggleApiKeyInputs()">
                        <option value="gemini">Google Gemini</option>
                        <option value="deepseek">DeepSeek V3</option>
                    </select>
                </div>

                <div id="geminiInputSection">
                    <div class="form-group">
                        <label class="form-label">Google Gemini API Key</label>
                        <input type="password" id="apiKeyInput" class="filter-input" placeholder="Gemini API Key ÏûÖÎ†•"
                            style="width: 100%;">
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #667eea;">ÌÇ§
                                Î∞úÍ∏âÎ∞õÍ∏∞</a>
                        </p>
                    </div>
                </div>

                <div id="deepseekInputSection" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">DeepSeek API Key</label>
                        <input type="password" id="deepseekKeyInput" class="filter-input"
                            placeholder="DeepSeek API Key ÏûÖÎ†•" style="width: 100%;">
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                            <a href="https://platform.deepseek.com/api_keys" target="_blank" style="color: #667eea;">ÌÇ§
                                Î∞úÍ∏âÎ∞õÍ∏∞</a>
                        </p>
                    </div>
                </div>

                <p
                    style="font-size: 0.8rem; color: #999; margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                    ÌÇ§Îäî Î∏åÎùºÏö∞Ï†Ä LocalStorageÏóêÎßå Ï†ÄÏû•ÎêòÎ©∞ ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°ÎêòÏßÄ ÏïäÏäµÎãàÎã§.
                </p>

                <!-- Data Management -->
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                    <label class="form-label">üíæ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ Î∞è Î≥µÍµ¨</label>
                    <p style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">
                        Ï†ÄÏû•Îêú ÌÉúÍ∑∏, Î©îÎ™®, Ïª¨Î†âÏÖò, AI Î∂ÑÏÑù ÎÇ¥Ïö©ÏùÑ ÌååÏùºÎ°ú Ï†ÄÏû•ÌïòÍ±∞ÎÇò Î∂àÎü¨ÏòµÎãàÎã§.
                    </p>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="StorageManager.exportData()" class="modal-btn"
                            style="background:#4b5563; flex:1;">
                            üì§ Î∞±ÏóÖ Îã§Ïö¥Î°úÎìú
                        </button>
                        <button onclick="document.getElementById('importFile').click()" class="modal-btn"
                            style="background:#6b7280; flex:1;">
                            üì• Î≥µÍµ¨ (Î∂àÎü¨Ïò§Í∏∞)
                        </button>
                        <input type="file" id="importFile" style="display:none" accept=".json"
                            onchange="handleImport(this)">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveApiKey()" class="modal-btn github"
                    style="width: 100%; text-align: center;">Ï†ÄÏû•ÌïòÍ∏∞</button>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal-backdrop">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <div id="modalTitle" class="modal-title"></div>
                    <div id="modalOwner" class="modal-owner"></div>
                </div>
                <button id="closeModal" class="modal-close">‚úï</button>
            </div>
            <div id="modalContent" class="modal-content"></div>
            <div class="modal-footer">
                <a id="modalGithubLink" href="#" target="_blank" class="modal-btn github">
                    GitHubÏóêÏÑú Î≥¥Í∏∞
                </a>
                <a id="modalHomepage" href="#" target="_blank" class="modal-btn homepage hide">
                    ÌôàÌéòÏù¥ÏßÄ Î∞©Î¨∏
                </a>
            </div>
        </div>
    </div>

    <script>
        // Language Colors
        const languageColors = {
            JavaScript: '#f1e05a',
            TypeScript: '#3178c6',
            Python: '#3572A5',
            Java: '#b07219',
            'C++': '#f34b7d',
            C: '#555555',
            'C#': '#178600',
            Go: '#00ADD8',
            Rust: '#dea584',
            Ruby: '#701516',
            PHP: '#4F5D95',
            Swift: '#F05138',
            Kotlin: '#A97BFF',
            Dart: '#00B4AB',
            Scala: '#c22d40',
            Shell: '#89e051',
            HTML: '#e34c26',
            CSS: '#563d7c',
            Vue: '#41b883',
            Jupyter: '#DA5B0B',
            R: '#198CE7',
            Lua: '#000080',
            Elixir: '#6e4a7e',
            Haskell: '#5e5086',
            Clojure: '#db5855',
            Erlang: '#B83998'
        };

        // Category Detection
        const categoryKeywords = {
            'AI/ML': ['machine-learning', 'deep-learning', 'ai', 'neural', 'tensorflow', 'pytorch', 'ml', 'nlp', 'gpt', 'llm', 'transformer', 'bert', 'chatgpt', 'openai'],
            'Frontend': ['react', 'vue', 'angular', 'frontend', 'css', 'ui', 'component', 'tailwind', 'bootstrap', 'svelte', 'nextjs', 'nuxt'],
            'Backend': ['backend', 'api', 'server', 'express', 'django', 'flask', 'spring', 'fastapi', 'graphql', 'rest', 'microservice'],
            'DevOps': ['docker', 'kubernetes', 'ci-cd', 'devops', 'terraform', 'ansible', 'jenkins', 'github-actions', 'aws', 'cloud'],
            'Database': ['database', 'sql', 'nosql', 'mongodb', 'postgresql', 'mysql', 'redis', 'elasticsearch', 'orm'],
            'Mobile': ['ios', 'android', 'react-native', 'flutter', 'mobile', 'swift', 'kotlin'],
            'Tools': ['cli', 'tool', 'utility', 'productivity', 'automation', 'editor', 'terminal'],
            'Security': ['security', 'crypto', 'encryption', 'auth', 'oauth', 'jwt', 'vulnerability'],
            'Data': ['data', 'analytics', 'visualization', 'pandas', 'numpy', 'jupyter', 'dashboard']
        };

        let allRepos = [];
        let collections = [];
        let filteredRepos = [];
        let currentPage = 1;

        let isLoading = false;
        let currentCategory = 'all';
        let currentPurpose = 'all';
        let currentDecision = 'all'; // New
        let currentCollection = 'all';
        let currentView = 'grid'; // 'grid' or 'graph'
        const perPage = 100;
        const displayPerPage = 12;

        // --- Storage Manager ---
        const StorageManager = {
            KEY_METADATA: 'github_stars_metadata',
            KEY_COLLECTIONS: 'github_stars_collections',

            getMetadata() {
                try {
                    return JSON.parse(localStorage.getItem(this.KEY_METADATA)) || {};
                } catch { return {}; }
            },

            getCollections() {
                try {
                    // List of { id, name, description }
                    return JSON.parse(localStorage.getItem(this.KEY_COLLECTIONS)) || [];
                } catch { return []; }
            },

            saveMetadata(data) {
                localStorage.setItem(this.KEY_METADATA, JSON.stringify(data));
            },

            saveCollections(data) {
                localStorage.setItem(this.KEY_COLLECTIONS, JSON.stringify(data));
            },



            saveApiKey(key) {
                localStorage.setItem('gemini_api_key', key);
            },

            getApiKey() {
                return localStorage.getItem('gemini_api_key');
            },

            saveDeepSeekKey(key) {
                localStorage.setItem('deepseek_api_key', key);
            },

            getDeepSeekKey() {
                return localStorage.getItem('deepseek_api_key');
            },

            saveProvider(provider) {
                localStorage.setItem('ai_provider', provider);
            },

            getProvider() {
                return localStorage.getItem('ai_provider') || 'gemini';
            },

            getRepoData(repoId) {
                const data = this.getMetadata();
                return data[repoId] || { purpose: '', note: '', collectionIds: [] };
            },

            // --- Data Management (Export/Import) ---
            exportData() {
                const data = {
                    metadata: this.getMetadata(),
                    collections: this.getCollections(),
                    history: this.getSearchHistory(),
                    aiProvider: this.getProvider(),
                    timestamp: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `github-stars-backup-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            },

            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.metadata) this.saveMetadata(data.metadata);
                            if (data.collections) this.saveCollections(data.collections);
                            if (data.history) localStorage.setItem('github_stars_history', JSON.stringify(data.history));
                            if (data.aiProvider) this.saveProvider(data.aiProvider);
                            resolve(true);
                        } catch (err) {
                            reject(err);
                        }
                    };
                    reader.readAsText(file);
                });
            },
            updateRepoData(repoId, updates) {
                const data = this.getMetadata();
                data[repoId] = { ...(data[repoId] || {}), ...updates };
                this.saveMetadata(data);
                return data[repoId];
            },

            createCollection(name) {
                const list = this.getCollections();
                const newColl = { id: 'col_' + Date.now(), name, description: '' };
                list.push(newColl);
                this.saveCollections(list);
                return newColl;
            },

            // Utility: Get collections for a repo
            getRepoCollections(repoId) {
                const repoData = this.getRepoData(repoId);
                const collectionIds = repoData.collectionIds || [];
                const allColls = this.getCollections();
                return allColls.filter(c => collectionIds.includes(c.id));
            },

            // --- Search History ---
            getSearchHistory() {
                try {
                    return JSON.parse(localStorage.getItem('github_stars_history')) || [];
                } catch { return []; }
            },

            saveSearchHistory(username) {
                const list = this.getSearchHistory();
                // Remove existing if any (to move to top)
                const filtered = list.filter(u => u.toLowerCase() !== username.toLowerCase());
                filtered.unshift(username);
                // Keep max 5
                const result = filtered.slice(0, 5);
                localStorage.setItem('github_stars_history', JSON.stringify(result));
            }
        };

        // Update History Datalist
        function updateHistoryList() {
            const list = StorageManager.getSearchHistory();
            const datalist = document.getElementById('historyList');
            if (datalist) {
                datalist.innerHTML = list.map(u => `<option value="${u}">`).join('');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateHistoryList();

            // Load Collections
            collections = StorageManager.getCollections();

            // Auto-fill last user
            const list = StorageManager.getSearchHistory();
            if (list.length > 0) {
                document.getElementById('usernameInput').value = list[0];
            }
        });

        // DOM Elements
        const usernameInput = document.getElementById('usernameInput');
        const searchBtn = document.getElementById('searchBtn');
        const errorMsg = document.getElementById('errorMsg');
        const statsSection = document.getElementById('statsSection');
        const filterSection = document.getElementById('filterSection');
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');
        const reposGrid = document.getElementById('reposGrid');
        const loadMoreSection = document.getElementById('loadMoreSection');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const filterInput = document.getElementById('filterInput');
        const sortSelect = document.getElementById('sortSelect');
        const purposeFilter = document.getElementById('purposeFilter');
        const decisionFilter = document.getElementById('decisionFilter'); // New
        const categoryChips = document.getElementById('categoryChips');
        const collectionsBar = document.getElementById('collectionsBar');
        const detailModal = document.getElementById('detailModal');

        const closeModal = document.getElementById('closeModal');
        // Settings
        const settingsModal = document.getElementById('settingsModal');
        const closeSettings = document.getElementById('closeSettings');
        const apiKeyInput = document.getElementById('apiKeyInput'); // Gemini
        const deepseekKeyInput = document.getElementById('deepseekKeyInput');
        const aiProviderSelect = document.getElementById('aiProviderSelect');
        const geminiInputSection = document.getElementById('geminiInputSection');
        const deepseekInputSection = document.getElementById('deepseekInputSection');

        // Event Listeners
        searchBtn.addEventListener('click', handleSearch);
        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearch();
        });
        filterInput.addEventListener('input', debounce(handleFilter, 300));
        sortSelect.addEventListener('change', handleSort);
        purposeFilter.addEventListener('change', handlePurposeFilter);
        decisionFilter.addEventListener('change', handleDecisionFilter); // New
        loadMoreBtn.addEventListener('click', loadMore);
        closeModal.addEventListener('click', () => detailModal.classList.remove('show'));
        detailModal.addEventListener('click', (e) => {
            if (e.target === detailModal) detailModal.classList.remove('show');
        });

        // Settings Events
        closeSettings.addEventListener('click', () => settingsModal.classList.remove('show'));
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) settingsModal.classList.remove('show');
        });

        // Toggle API Key Input Visibility
        window.toggleApiKeyInputs = function () {
            const provider = aiProviderSelect.value;
            if (provider === 'gemini') {
                geminiInputSection.style.display = 'block';
                deepseekInputSection.style.display = 'none';
            } else {
                geminiInputSection.style.display = 'none';
                deepseekInputSection.style.display = 'block';
            }
        };

        window.openSettings = function () {
            // Load saved values
            const savedProvider = StorageManager.getProvider();
            const savedGemini = StorageManager.getApiKey();
            const savedDeepSeek = StorageManager.getDeepSeekKey();

            aiProviderSelect.value = savedProvider;
            apiKeyInput.value = savedGemini || '';
            deepseekKeyInput.value = savedDeepSeek || '';

            toggleApiKeyInputs(); // Refresh UI State
            settingsModal.classList.add('show');
        };

        window.saveApiKey = function () {
            const provider = aiProviderSelect.value;
            const geminiKey = apiKeyInput.value.trim();
            const deepseekKey = deepseekKeyInput.value.trim();

            if (provider === 'gemini' && !geminiKey) {
                alert('Gemini API KeyÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            if (provider === 'deepseek' && !deepseekKey) {
                alert('DeepSeek API KeyÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // Save All
            StorageManager.saveProvider(provider);
            if (geminiKey) StorageManager.saveApiKey(geminiKey);
            if (deepseekKey) StorageManager.saveDeepSeekKey(deepseekKey);

            settingsModal.classList.remove('show');
            alert('ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
        };

        // Handle Import
        window.handleImport = async function (input) {
            if (!input.files || !input.files[0]) return;
            const file = input.files[0];
            try {
                await StorageManager.importData(file);
                alert('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥µÍµ¨ÎêòÏóàÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï©ÎãàÎã§.');
                window.location.reload();
            } catch (e) {
                alert('ÌååÏùºÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                console.error(e);
            }
            input.value = ''; // Reset
        };

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Fetch Stars
        async function fetchStars(username, page = 1) {
            const response = await fetch(
                `https://api.github.com/users/${username}/starred?per_page=${perPage}&page=${page}`,
                {
                    headers: {
                        'Accept': 'application/vnd.github.v3+json'
                    }
                }
            );

            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error('ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                if (response.status === 403) {
                    throw new Error('API Ìò∏Ï∂ú Ï†úÌïúÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
                throw new Error('Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
            }

            return response.json();
        }

        // Fetch all stars with pagination
        async function fetchAllStars(username) {
            let page = 1;
            let allStars = [];
            let hasMore = true;

            while (hasMore) {
                const stars = await fetchStars(username, page);
                allStars = allStars.concat(stars);

                if (stars.length < perPage) {
                    hasMore = false;
                } else {
                    page++;
                }

                // Update loading message
                document.querySelector('#loadingState p').textContent =
                    `${allStars.length}Í∞úÏùò StarsÎ•º Î∂àÎü¨ÏôîÏäµÎãàÎã§...`;
            }

            return allStars;
        }

        // Detect category for a repo
        function detectCategory(repo) {
            const searchText = [
                repo.name,
                repo.description || '',
                ...(repo.topics || [])
            ].join(' ').toLowerCase();

            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                if (keywords.some(kw => searchText.includes(kw))) {
                    return category;
                }
            }

            return 'Others';
        }

        // Analyze repos
        function analyzeRepos(repos) {
            const languages = new Set();
            const topics = new Set();
            let totalStars = 0;
            const categories = {};

            repos.forEach(repo => {
                if (repo.language) languages.add(repo.language);
                (repo.topics || []).forEach(t => topics.add(t));
                totalStars += repo.stargazers_count;

                const category = detectCategory(repo);
                repo._category = category;
                categories[category] = (categories[category] || 0) + 1;
            });

            return {
                totalRepos: repos.length,
                languages: languages.size,
                topics: topics.size,
                avgStars: repos.length > 0 ? Math.round(totalStars / repos.length) : 0,
                categories
            };
        }

        // Generate usage guide
        function generateGuide(repo) {
            const lang = repo.language || 'Unknown';
            const topics = repo.topics || [];
            const category = repo._category || 'Others';

            let guide = '';

            // Category Badge & Health
            const health = calculateRepoHealth(repo);
            guide += `<div class="guide-category" style="display:flex; justify-content:space-between; align-items:center;">
                <span class="guide-category-tag">${category}</span>
                <span class="health-badge ${health.color}">
                    <span class="health-dot"></span> Ïú†ÏßÄÎ≥¥Ïàò: ${health.label}
                </span>
            </div>`;

            // Description
            if (repo.description) {
                guide += `<div class="guide-section">
                    <h3 class="guide-section-title">
                        <span class="icon blue">‚ÑπÔ∏è</span> ÏÜåÍ∞ú
                    </h3>
                    <p class="guide-text">${repo.description}</p>
                </div>`;
            }

            // Quick Stats
            guide += `<div class="guide-section">
                <div class="guide-stats">
                    <div class="guide-stat">
                        <div class="guide-stat-value yellow">‚≠ê ${formatNumber(repo.stargazers_count)}</div>
                        <div class="guide-stat-label">Stars</div>
                    </div>
                    <div class="guide-stat">
                        <div class="guide-stat-value blue">üîÄ ${formatNumber(repo.forks_count)}</div>
                        <div class="guide-stat-label">Forks</div>
                    </div>
                    <div class="guide-stat">
                        <div class="guide-stat-value green">üëÅ ${formatNumber(repo.watchers_count)}</div>
                        <div class="guide-stat-label">Watchers</div>
                    </div>
                </div>
            </div>`;

            // Quick Start Guide
            guide += `<div class="guide-section">
                <h3 class="guide-section-title">
                    <span class="icon green">üöÄ</span> Îπ†Î•∏ ÏãúÏûë
                </h3>
                <div class="guide-code">`;

            // Generate install command based on language/category
            if (lang === 'JavaScript' || lang === 'TypeScript') {
                guide += `<div class="comment"># npmÏúºÎ°ú ÏÑ§Ïπò</div>
                    <div>npm install ${repo.name}</div>
                    <br>
                    <div class="comment"># ÎòêÎäî yarn</div>
                    <div>yarn add ${repo.name}</div>`;
            } else if (lang === 'Python') {
                guide += `<div class="comment"># pipÎ°ú ÏÑ§Ïπò</div>
                    <div>pip install ${repo.name}</div>`;
            } else if (lang === 'Go') {
                guide += `<div class="comment"># Go Î™®ÎìàÎ°ú ÏÑ§Ïπò</div>
                    <div>go get github.com/${repo.full_name}</div>`;
            } else if (lang === 'Rust') {
                guide += `<div class="comment"># CargoÎ°ú ÏÑ§Ïπò</div>
                    <div>cargo add ${repo.name}</div>`;
            } else if (lang === 'Ruby') {
                guide += `<div class="comment"># GemÏúºÎ°ú ÏÑ§Ïπò</div>
                    <div>gem install ${repo.name}</div>`;
            } else {
                guide += `<div class="comment"># GitÏúºÎ°ú ÌÅ¥Î°†</div>
                    <div>git clone ${repo.clone_url}</div>
                    <div>cd ${repo.name}</div>`;
            }

            guide += `</div></div>`;

            // Topics
            if (topics.length > 0) {
                guide += `<div class="guide-section">
                    <h3 class="guide-section-title">
                        <span class="icon purple">üè∑Ô∏è</span> Í¥ÄÎ†® ÌÜ†ÌîΩ
                    </h3>
                    <div class="guide-topics">
                        ${topics.map(t => `<span class="guide-topic">${t}</span>`).join('')}
                    </div>
                </div>`;
            }

            // Use Cases based on category
            guide += `<div class="guide-section">
                <h3 class="guide-section-title">
                    <span class="icon yellow">üí°</span> ÌôúÏö© Î∞©Î≤ï
                </h3>
                <ul class="guide-usecases">`;

            const useCases = getUseCases(category, repo);
            useCases.forEach(uc => {
                guide += `<li class="guide-usecase">
                    <span class="check">‚úì</span>
                    <span>${uc}</span>
                </li>`;
            });

            guide += `</ul></div>`;

            // Last Updated
            guide += `<div class="guide-updated">
                üïê ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${new Date(repo.updated_at).toLocaleDateString('ko-KR')}
            </div>`;

            return guide;
        }

        // Render User Data Section (Purpose & Notes & Collections)
        function renderUserDataSection(repo) {
            const userData = repo.userData || { purpose: '', note: '', collectionIds: [] };
            const allCollections = StorageManager.getCollections();
            const repoCollIds = userData.collectionIds || [];

            let collectionsHtml = allCollections.map(col => {
                const isChecked = repoCollIds.includes(col.id) ? 'checked' : '';
                return `
                    <label style="display:inline-flex; align-items:center; margin-right:10px; margin-bottom:5px; font-size:0.9rem; padding:4px 8px; background:#fff; border:1px solid #ddd; border-radius:4px;">
                        <input type="checkbox" value="${col.id}" ${isChecked} onchange="toggleCollection('${repo.id}', '${col.id}', this.checked)" style="margin-right:5px;">
                        ${col.name}
                    </label>
                `;
            }).join('');

            if (allCollections.length === 0) {
                collectionsHtml = `<span style="color:#888; font-size:0.85rem;">ÏïÑÏßÅ Ïª¨Î†âÏÖòÏù¥ ÏóÜÏäµÎãàÎã§. <br>üëâ 'AI ÎèÑÍµ¨', 'ÌîÑÎ°†Ìä∏ÏóîÎìú' Í∞ôÏùÄ Ïª¨Î†âÏÖòÏùÑ ÎßåÎì§Ïñ¥ Î∂ÑÎ•òÌï¥Î≥¥ÏÑ∏Ïöî.</span>`;
            }

            return `
                <div class="user-data-section">
                    <div class="user-data-title">
                        <span>üè∑Ô∏è ÎÇòÏùò ÎÖ∏Ìä∏ & Î∂ÑÎ•ò</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ïù¥ RepoÎ•º StarÌïú Î™©Ï†ÅÏùÄ?</label>
                        <select id="repoPurpose" class="form-select" onchange="saveRepoData('${repo.id}')">
                            <option value="">(ÏÑ†ÌÉù Ïïà Ìï®)</option>
                            <option value="reference" ${userData.purpose === 'reference' ? 'selected' : ''}>üìö Ï∞∏Í≥†Ïö© (Reference)</option>
                            <option value="to-try" ${userData.purpose === 'to-try' ? 'selected' : ''}>üß™ ÎÇòÏ§ëÏóê Ïç®Î≥º Í≤É (To Try)</option>
                            <option value="idea" ${userData.purpose === 'idea' ? 'selected' : ''}>üí° ÏïÑÏù¥ÎîîÏñ¥ ÏñªÍ∏∞ (Idea)</option>
                            <option value="alternative" ${userData.purpose === 'alternative' ? 'selected' : ''}>üîÑ ÎåÄÏ≤¥Ïû¨ Ï°∞ÏÇ¨ (Alternative)</option>
                            <option value="using" ${userData.purpose === 'using' ? 'selected' : ''}>üõ† Ïã§Ï†ú ÏÇ¨Ïö© Ï§ë (Using)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ìïú Ï§Ñ Î©îÎ™®</label>
                        <textarea id="repoNote" class="form-textarea" placeholder="Ïù¥ Î†àÌè¨Ïùò ÌïµÏã¨Ïù¥ Î≠êÏòÄÎçîÎùº..." onblur="saveRepoData('${repo.id}')">${userData.note || ''}</textarea>
                    </div>
                    
                    <!-- AI Section -->
                    <div class="ai-section">
                        <div class="ai-header" id="aiHeader-${repo.id}">
                            <div class="ai-title">‚ú® AI Ïù∏ÏÇ¨Ïù¥Ìä∏ ¬∑ ÌïúÍµ≠Ïñ¥ Ïã§Ìñâ Í∞ÄÏù¥Îìú</div>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <button class="ai-btn" onclick="generateAISummary('${repo.id}')" id="aiBtn-${repo.id}">
                                    ${userData.aiSummary ? 'üîÑ Îã§Ïãú Î∂ÑÏÑù' : '‚ö° Ïã¨Ï∏µ Î∂ÑÏÑù'}
                                </button>
                            </div>
                        </div>
                        <div id="aiContent-${repo.id}" class="ai-content">
                            ${userData.aiSummary ? renderMarkdown(userData.aiSummary) + `
                                <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #e5e7eb; display:flex; justify-content:space-between; align-items:center; font-size:0.75rem; color:#6b7280;">
                                    <span>‚ö†Ô∏è AI Î∂ÑÏÑù Í≤∞Í≥ºÎäî Ï∂îÏ†ïÏπòÏù¥Î©∞ Ï†ïÌôïÌïòÏßÄ ÏïäÏùÑ Ïàò ÏûàÏäµÎãàÎã§.</span>
                                    <span style="background:#f3f4f6; padding:2px 8px; border-radius:12px;">
                                        Generated by ${userData.aiProvider === 'deepseek' ? 'DeepSeek üêã' : 'Gemini ‚ú®'}
                                    </span>
                                </div>
                            ` : '<span style="color:#888;">Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ AIÍ∞Ä Ïù¥ Î†àÌè¨ÏßÄÌÜ†Î¶¨Î•º Î∂ÑÏÑùÌï¥ÎìúÎ¶ΩÎãàÎã§.</span>'}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="display:flex; justify-content:space-between;">
                            <span>üìö Ïª¨Î†âÏÖòÏóê Ï∂îÍ∞Ä</span>
                            <button onclick="createNewCollectionInModal('${repo.id}')" style="background:none; border:none; color:#764ba2; cursor:pointer; font-size:0.8rem; font-weight:bold;">+ ÏÉà Ïª¨Î†âÏÖò</button>
                        </label>
                        <div id="modalCollectionsList">
                            ${collectionsHtml}
                        </div>
                    </div>

                    <!-- Explicit Save Button -->
                    <div style="margin-top: 20px; text-align: right; display: flex; align-items: center; justify-content: flex-end; gap: 10px;">
                        <span id="saveStatus" style="font-size: 0.8rem; color: #10b981; opacity: 0; transition: opacity 0.5s;">‚úÖ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§</span>
                        <button onclick="manualSave('${repo.id}')" class="save-btn" style="float:none;">
                            üíæ Ï†ÄÏû•ÌïòÍ∏∞
                        </button>
                    </div>

                </div>
            `;
        }

        // Manual Save Wrapper
        window.manualSave = function (repoId) {
            saveRepoData(repoId);
            const status = document.getElementById('saveStatus');
            status.style.opacity = '1';
            setTimeout(() => status.style.opacity = '0', 2000);
        };

        // Get use cases based on category (Refined for Senior/Pro level)
        function getUseCases(category, repo) {
            const cases = {
                'AI/ML': [
                    'ÌîÑÎ°úÎçïÏÖò ÏóêÏù¥Ï†ÑÌä∏Ïóê Ïä§ÌÇ¨ Î†àÏù¥Ïñ¥ Ï∂îÍ∞Ä',
                    'Vercel AI SDK Îì± ÏµúÏã† ÏóêÏù¥Ï†ÑÌä∏ ÏÑ§Í≥Ñ Ìå®ÌÑ¥ Ï∞∏Í≥†',
                    'Ïä§ÌÇ¨ Ïª¥Ìè¨ÏßÄÏÖò(Composition) ÏïÑÌÇ§ÌÖçÏ≤ò ÌïôÏäµ',
                    'Î≥¥Ïïà Î∞è ÏóêÎü¨ Ï≤òÎ¶¨ Î≤†Ïä§Ìä∏ ÌîÑÎûôÌã∞Ïä§ Ï†ÅÏö©'
                ],
                'Frontend': [
                    'ÎîîÏûêÏù∏ ÏãúÏä§ÌÖúÏùò Ïª¥Ìè¨ÎÑåÌä∏ Íµ¨Ï°∞ Î≤§ÏπòÎßàÌÇπ',
                    'Î†åÎçîÎßÅ ÏµúÏ†ÅÌôî(Performance) Ìå®ÌÑ¥ ÌïôÏäµ',
                    'ÏÉÅÌÉú Í¥ÄÎ¶¨(State Management) ÏïÑÌÇ§ÌÖçÏ≤ò Î∂ÑÏÑù',
                    'Ï†ëÍ∑ºÏÑ±(a11y) Î∞è Î∞òÏùëÌòï Íµ¨ÌòÑ ÌëúÏ§Ä Ï∞∏Í≥†'
                ],
                'Backend': [
                    'ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§(MSA) ÌÜµÏã† Ìå®ÌÑ¥ Î∂ÑÏÑù',
                    'ÎåÄÏö©Îüâ Ìä∏ÎûòÌîΩ Ï≤òÎ¶¨ Î∞è Ï∫êÏã± Ï†ÑÎûµ ÌïôÏäµ',
                    'API Ïù∏Ï¶ù/Ïù∏Í∞Ä(Auth) Î≥¥Ïïà Íµ¨Ï°∞ Ï∞∏Í≥†',
                    'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà Î∞è ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï†ÑÎûµ'
                ],
                'DevOps': [
                    'IaC(Infrastructure as Code) Î™®Î≤î ÏÇ¨Î°Ä Ïó∞Íµ¨',
                    'CI/CD ÌååÏù¥ÌîÑÎùºÏù∏ ÏµúÏ†ÅÌôî Ï†ÑÎûµ',
                    'Ïª®ÌÖåÏù¥ÎÑà Ïò§ÏºÄÏä§Ìä∏Î†àÏù¥ÏÖò Î∞è Î™®ÎãàÌÑ∞ÎßÅ',
                    'Î∞∞Ìè¨ ÏûêÎèôÌôî Ïä§ÌÅ¨Î¶ΩÌä∏ ÌÖúÌîåÎ¶ø ÌôúÏö©'
                ],
                'Database': [
                    'ÏøºÎ¶¨ ÏµúÏ†ÅÌôî Î∞è Ïù∏Îç±Ïã± Ï†ÑÎûµ',
                    'Îç∞Ïù¥ÌÑ∞ ÏùºÍ¥ÄÏÑ±(Consistency) Î™®Îç∏ Ïó∞Íµ¨',
                    'ÏÉ§Îî©(Sharding) Î∞è ÌååÌã∞ÏÖîÎãù Íµ¨Ï°∞ ÌïôÏäµ',
                    'NoSQL vs SQL Î™®Îç∏ÎßÅ Ìå®ÌÑ¥ ÎπÑÍµê'
                ],
                'Mobile': [
                    'ÌÅ¨Î°úÏä§ ÌîåÎû´Ìèº ÏÑ±Îä• ÏµúÏ†ÅÌôî Í∏∞Î≤ï',
                    'ÎÑ§Ïù¥Ìã∞Î∏å Î™®Îìà Ïó∞Îèô ÏïÑÌÇ§ÌÖçÏ≤ò',
                    'Ïò§ÌîÑÎùºÏù∏ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ï†ÑÎûµ',
                    'Î™®Î∞îÏùº Ï†ÑÏö© UI/UX Ìå®ÌÑ¥ Î≤§ÏπòÎßàÌÇπ'
                ],
                'Tools': [
                    'Í∞úÎ∞ú ÏÉùÏÇ∞ÏÑ± ÏûêÎèôÌôî ÏõåÌÅ¨ÌîåÎ°úÏö∞',
                    'CLI ÎèÑÍµ¨ ÏÑ§Í≥Ñ Î∞è Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Ìå®ÌÑ¥',
                    'ÌîåÎü¨Í∑∏Ïù∏ ÏïÑÌÇ§ÌÖçÏ≤ò ÌôïÏû•ÏÑ± Ïó∞Íµ¨',
                    'Í∞úÎ∞ú ÌôòÍ≤Ω ÌëúÏ§ÄÌôî(Dotfiles Îì±) Ï∞∏Í≥†'
                ],
                'Security': [
                    'Ï∑®ÏïΩÏ†ê Î∂ÑÏÑù Î∞è Ïπ®Ìà¨ ÌÖåÏä§Ìä∏ ÏãúÎÇòÎ¶¨Ïò§',
                    'ÏïîÌò∏Ìôî/Î≥µÌò∏Ìôî ÌÇ§ Í¥ÄÎ¶¨ ÏïÑÌÇ§ÌÖçÏ≤ò',
                    'OAuth/JWT Ïù∏Ï¶ù ÌùêÎ¶Ñ Ïã¨Ï∏µ Î∂ÑÏÑù',
                    'ÏãúÌÅêÏñ¥ ÏΩîÎî©(Secure Coding) Í∞ÄÏù¥ÎìúÎùºÏù∏'
                ],
                'Data': [
                    'ETL ÌååÏù¥ÌîÑÎùºÏù∏ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Íµ¨Ï°∞',
                    'ÎåÄÏãúÎ≥¥Îìú ÏãúÍ∞ÅÌôî ÎùºÏù¥Î∏åÎü¨Î¶¨ ÌôúÏö©',
                    'Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Ïä§Ìä∏Î¶¨Î∞ç Ï≤òÎ¶¨ Ìå®ÌÑ¥',
                    'Îç∞Ïù¥ÌÑ∞ Ï†ïÏ†ú Î∞è Ï†ÑÏ≤òÎ¶¨ ÏûêÎèôÌôî'
                ],
                'Others': [
                    'ÌîÑÎ°úÏ†ùÌä∏ Ìè¥Îçî Íµ¨Ï°∞(Scaffolding) Î∂ÑÏÑù',
                    'ÌÖåÏä§Ìä∏ ÏΩîÎìú ÏûëÏÑ± Ìå®ÌÑ¥ Î∞è Ïª§Î≤ÑÎ¶¨ÏßÄ',
                    'Í∏∞Ïó¨ Í∞ÄÏù¥Îìú(Contributing) ÏûëÏÑ±Î≤ï Ï∞∏Í≥†',
                    'Ïò§ÌîàÏÜåÏä§ ÎùºÏù¥ÏÑ†Ïä§ Î∞è Î∞∞Ìè¨ Ï†ÑÎûµ ÌôïÏù∏'
                ]
            };

            return cases[category] || cases['Others'];
        }

        // Extract AI One-Liner (Hybrid: JSON + Markdown Fallback)
        function extractAIOneLiner(data) {
            if (!data) return null;

            // 1. JSON Schema Support (Phase 2)
            if (typeof data === 'object' && data.identity?.desc_one_liner) {
                return data.identity.desc_one_liner;
            }

            // 2. Legacy Markdown Support
            const markdown = typeof data === 'string' ? data : '';
            if (!markdown) return null;

            // Strategy 1: Explicit keyword
            const keyMatch = markdown.match(/[\-\*]?\s*(?:\*\*)?\s*(?:Ìïú\s*Ï§Ñ\s*Ï†ïÏùò|Ìïú\s*Ï§Ñ\s*ÏöîÏïΩ|ÌïµÏã¨\s*Í∞ÄÏπò)\s*(?:\*\*)?.*?[:Ôºö]\s*(.*)$/m);
            if (keyMatch && keyMatch[1]) return keyMatch[1].replace(/\*\*/g, '').trim();

            // Strategy 2: First bullet under Section
            const sectionMatch = markdown.match(/##\s*üöÄ?\s*.*?(?:Who\s*&\s*Why|ÌïµÏã¨\s*Í∞ÄÏπò).*?[\r\n]+\s*[\-\*]\s*(.*)$/m);
            if (sectionMatch && sectionMatch[1]) {
                return sectionMatch[1].replace(/^(?:\*\*)?(?:Ìïú\s*Ï§Ñ\s*Ï†ïÏùò|Ìïú\s*Ï§Ñ\s*ÏöîÏïΩ).*?[:Ôºö]\s*/, '').replace(/\*\*/g, '').trim();
            }

            // Strategy 3: Loose match
            const looseMatch = markdown.match(/Ìïú\s*Ï§Ñ\s*Ï†ïÏùò.*?[:Ôºö]\s*(.*)/);
            if (looseMatch && looseMatch[1]) return looseMatch[1].replace(/\*\*/g, '').trim();

            // Strategy 4: Fallback body text
            const bodyMatch = markdown.match(/##\s*.*?(?:Who\s*&\s*Why|ÌïµÏã¨\s*Í∞ÄÏπò|ÏöîÏïΩ|Í∞úÏöî).*?[\r\n]+([^\r\n#\-*]+)/);
            if (bodyMatch && bodyMatch[1]) return bodyMatch[1].trim();

            return null;
        }

        // Format number
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // Calculate Repo Health
        function calculateRepoHealth(repo) {
            if (repo.archived) return { status: 'archived', label: 'üì¶ Î≥¥Í¥ÄÎê®', color: 'archived' };

            const lastUpdate = new Date(repo.updated_at);
            const now = new Date();
            const diffDays = (now - lastUpdate) / (1000 * 60 * 60 * 24);

            if (diffDays < 90) return { status: 'active', label: 'üü¢ ÌôúÏÑ±', color: 'active' }; // 3 months
            if (diffDays < 365) return { status: 'stable', label: 'üîµ ÏïàÏ†ï', color: 'stable' }; // 1 year
            return { status: 'stale', label: '‚ö†Ô∏è Ï†ïÏ≤¥', color: 'stale' };
        }

        // Render repo card
        function renderRepoCard(repo) {
            const langColor = languageColors[repo.language] || '#888';
            const health = calculateRepoHealth(repo);
            const aiOneLiner = extractAIOneLiner(repo.userData?.aiSummary);
            const description = aiOneLiner
                ? `<span style="color:#4b5563; font-weight:600;">‚ú® ${aiOneLiner}</span>`
                : (repo.description || 'ÏÑ§Î™Ö ÏóÜÏùå');

            return `
                <div class="repo-card" onclick="showDetail('${repo.id}')">
                    <div class="repo-header">
                        <div class="repo-name">
                            ${repo.name}
                            ${getPurposeBadge(repo.userData?.purpose)}
                            ${repo.userData?.aiSummary ? '<span class="ai-status-badge">‚ú® AI</span>' : ''}
                        </div>
                        <span class="repo-stars">‚≠ê ${formatNumber(repo.stargazers_count)}</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <span class="health-badge ${health.color}">
                            <span class="health-dot"></span> ${health.label}
                        </span>
                    </div>
                    <p class="repo-desc">${description}</p>
                    <div class="repo-footer">
                        ${repo.language ? `
                            <span class="language-badge">
                                <span class="language-dot" style="background: ${langColor}"></span>
                                ${repo.language}
                            </span>
                        ` : '<span></span>'}
                        <span class="repo-owner">${repo.owner.login}</span>
                    </div>
                    <div class="repo-category">
                        <span class="category-tag">${repo._category}</span>
                    </div>
                </div>
            `;
        }

        function getPurposeBadge(purpose) {
            if (!purpose) return '';
            const labels = {
                'reference': 'üìö',
                'to-try': 'üß™',
                'idea': 'üí°',
                'alternative': 'üîÑ',
                'using': 'üõ†'
            };
            return labels[purpose] ? `<span class="purpose-tag">${labels[purpose]}</span>` : '';
        }

        // Save Decision Snapshot
        window.saveDecision = function (repoId, decision) {
            // Update Data
            StorageManager.updateRepoData(repoId, { decision_snapshot: decision });

            // Update Local State
            const repo = allRepos.find(r => r.id == repoId);
            if (repo) {
                if (!repo.userData) repo.userData = {};
                repo.userData.decision_snapshot = decision;
            }

            // Update UI (Active Class)
            const btns = document.querySelectorAll('.d-btn');
            btns.forEach(btn => btn.classList.remove('active'));

            // Find specific button in the current modal to activate
            // Identify by onclick attribute or event target if passed, but simpler to relying on re-render or class lookup
            // Since we use onclick="saveDecision...", we can just re-render or toggle classes.
            // But to be robust given multiple potential buttons (if list view had them):
            const container = document.querySelector('.toggle-container');
            if (container) {
                const targetBtn = container.querySelector(`.${decision}`);
                if (targetBtn) targetBtn.classList.add('active');
            }
        };

        // Save Repo Data
        window.saveRepoData = function (repoId) {
            const purpose = document.getElementById('repoPurpose').value;
            const note = document.getElementById('repoNote').value;
            const statusEl = document.getElementById('saveStatus');

            StorageManager.updateRepoData(repoId, { purpose, note });

            // Update local state
            const repo = allRepos.find(r => r.id == repoId);
            if (repo) {
                repo.userData = { purpose, note };
            }

            statusEl.textContent = 'Ï†ÄÏû•Îê® ‚úì';
            setTimeout(() => { statusEl.textContent = ''; }, 2000);

            // Re-render grid to update badges if needed (optional optimization: only update specific card)
            debounce(handleSort, 500)();
        };

        // Show detail modal
        window.showDetail = function (repoId) {
            try {
                const repo = allRepos.find(r => r.id == repoId);
                if (!repo) return;

                document.getElementById('modalTitle').textContent = repo.name;
                document.getElementById('modalOwner').textContent = `@${repo.owner.login} `;

                // Debugging
                // console.log('Generating guide for:', repo.name);

                const guideHtml = generateGuide(repo);
                const userHtml = renderUserDataSection(repo);

                document.getElementById('modalContent').innerHTML = guideHtml + userHtml;
                document.getElementById('modalGithubLink').href = repo.html_url;

                const homepageBtn = document.getElementById('modalHomepage');
                if (repo.homepage) {
                    homepageBtn.href = repo.homepage;
                    homepageBtn.classList.remove('hide');
                } else {
                    homepageBtn.classList.add('hide');
                }

                detailModal.classList.add('show');
            } catch (err) {
                console.error("Detail Error:", err);
                alert("ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: " + err.message);
            }
        };

        // Render Repo List Item
        function renderRepoListItem(repo) {
            const langColor = languageColors[repo.language] || '#888';
            const health = calculateRepoHealth(repo);
            const isAIAnalyzed = !!repo.userData?.aiSummary;
            const aiOneLiner = extractAIOneLiner(repo.userData?.aiSummary);
            const description = aiOneLiner
                ? `<span style="color:#4b5563; font-weight:600;">‚ú® ${aiOneLiner}</span>`
                : (repo.description || 'ÏÑ§Î™Ö ÏóÜÏùå');

            return `
                <div class="repo-list-item" onclick="showDetail('${repo.id}')">
                    <div class="repo-list-info">
                        <div class="repo-list-name">
                            ${repo.name}
                            ${getPurposeBadge(repo.userData?.purpose)}
                            ${isAIAnalyzed ? `<span class="ai-status-badge">‚ú® AI Analyzed</span>` : ''}
                        </div>
                        <div class="repo-list-desc">
                            ${description}
                        </div>
                    </div>
                    <div class="repo-list-meta">
                        ${repo.language ? `
                            <span style="display:flex; align-items:center; gap:5px;">
                                <span class="language-dot" style="background: ${langColor}"></span>
                                ${repo.language}
                            </span>
                        ` : ''}
                        <span>‚≠ê ${formatNumber(repo.stargazers_count)}</span>
                        <span class="health-badge ${health.color}" style="font-size:0.75rem; padding:2px 6px;">
                            ${health.label}
                        </span>
                    </div>
                </div>
            `;
        }

        // Handle Decision Filter
        function handleDecisionFilter() {
            currentDecision = decisionFilter.value;
            handleFilter();
        }

        // Render repos
        function renderRepos(repos, append = false) {
            const gridEl = document.getElementById('reposGrid');
            const listEl = document.getElementById('reposList');

            if (!append) {
                gridEl.innerHTML = '';
                listEl.innerHTML = '';
            }

            repos.forEach(repo => {
                gridEl.innerHTML += renderRepoCard(repo);
                listEl.innerHTML += renderRepoListItem(repo);
            });
        }

        // Update stats
        function updateStats(stats) {
            document.getElementById('totalStars').textContent = stats.totalRepos;
            document.getElementById('totalLanguages').textContent = stats.languages;
            document.getElementById('totalTopics').textContent = stats.topics;
            document.getElementById('avgStars').textContent = formatNumber(stats.avgStars);
        }

        // Update category chips
        function updateCategoryChips(categories) {
            const sorted = Object.entries(categories).sort((a, b) => b[1] - a[1]);

            categoryChips.innerHTML = `
                <button class="chip active" data-category="all" onclick="filterByCategory('all')">
                    Ï†ÑÏ≤¥ (${allRepos.length})
                </button>
            `;

            sorted.forEach(([cat, count]) => {
                categoryChips.innerHTML += `
                    <button class="chip" data-category="${cat}" onclick="filterByCategory('${cat}')">
                        ${cat} (${count})
                    </button>
                `;
            });
        }

        // Filter by category
        window.filterByCategory = function (category) {
            currentCategory = category;

            // Update active state
            document.querySelectorAll('.chip').forEach(chip => {
                if (chip.dataset.category === category) {
                    chip.classList.add('active');
                } else {
                    chip.classList.remove('active');
                }
            });

            handleFilter();
        };

        function handlePurposeFilter() {
            currentPurpose = purposeFilter.value;
            handleFilter();
        }

        // --- Collection Helper Functions ---
        // Toggle Collection
        window.toggleCollection = function (repoId, colId, isChecked) {
            const repoData = StorageManager.getRepoData(repoId);
            let collectionIds = repoData.collectionIds || [];

            if (isChecked) {
                if (!collectionIds.includes(colId)) collectionIds.push(colId);
            } else {
                collectionIds = collectionIds.filter(id => id !== colId);
            }

            StorageManager.updateRepoData(repoId, { collectionIds });

            // Update local state
            const repo = allRepos.find(r => r.id == repoId);
            if (repo) {
                repo.userData = repo.userData || {};
                repo.userData.collectionIds = collectionIds;
            }

            // Check if we need to refresh (filtering)
            if (currentCollection !== 'all') {
                handleFilter();
            }
        };

        // Create New Collection in Modal
        window.createNewCollectionInModal = function (repoId) {
            const name = prompt("ÏÉà Ïª¨Î†âÏÖò Ïù¥Î¶Ñ:");
            if (!name) return;

            StorageManager.createCollection(name);
            updateCollectionsBar(); // Refresh UI bar

            // Re-open detail to refresh list
            showDetail(repoId);
        };

        // Update Collections Bar
        function updateCollectionsBar() {
            const allCollections = StorageManager.getCollections();
            const bar = document.getElementById('collectionsBar');
            bar.style.display = 'flex';

            bar.innerHTML = `
                <button class="collection-btn ${currentCollection === 'all' ? 'active' : ''}" onclick="filterByCollection('all')">
                    üóÇ Ï†ÑÏ≤¥
                </button>
            `;

            allCollections.forEach(col => {
                bar.innerHTML += `
                    <button class="collection-btn ${currentCollection === col.id ? 'active' : ''}" onclick="filterByCollection('${col.id}')">
                        üìÅ ${col.name}
                    </button>
                `;
            });

            bar.innerHTML += `
                <button class="collection-btn add-coll" onclick="createNewCollectionFromBar()">
                    + ÎßåÎì§Í∏∞
                </button>
            `;
        }



        // --- View Switching ---
        window.switchView = function (view) {
            currentView = view;
            document.getElementById('viewGridBtn').classList.toggle('active', view === 'grid');
            document.getElementById('viewListBtn').classList.toggle('active', view === 'list');
            document.getElementById('viewGraphBtn').classList.toggle('active', view === 'graph');

            const gridEl = document.getElementById('reposGrid');
            const listEl = document.getElementById('reposList');
            const graphEl = document.getElementById('graphContainer');
            const loadMoreEl = document.getElementById('loadMoreSection');

            if (view === 'grid') {
                gridEl.classList.add('show');
                listEl.classList.remove('show');
                graphEl.classList.remove('show');
                loadMoreEl.classList.add('show');
            } else if (view === 'list') {
                gridEl.classList.remove('show');
                listEl.classList.add('show');
                graphEl.classList.remove('show');
                loadMoreEl.classList.add('show');
            } else {
                gridEl.classList.remove('show');
                listEl.classList.remove('show');
                graphEl.classList.add('show');
                loadMoreEl.classList.remove('show');
                renderGraph();
            }
        };

        // Render Graph
        function renderGraph() {
            const container = document.getElementById('graphContainer');
            const nodes = [];
            const edges = [];

            // 1. Create Nodes
            filteredRepos.forEach(repo => {
                const health = calculateRepoHealth(repo);
                let color = '#a5b4fc'; // Default
                if (health.status === 'stale') color = '#fca5a5';
                if (health.status === 'active') color = '#86efac';

                nodes.push({
                    id: repo.id,
                    label: repo.name,
                    title: repo.description,
                    shape: 'dot',
                    size: 15 + Math.log(repo.stargazers_count + 1) * 2,
                    color: color
                });
            });

            // 2. Create Edges (Simple Logic: Same Owner or Shared Topic)
            // Limit edges to prevent mess
            const repoCount = filteredRepos.length;
            if (repoCount < 300) { // Only do heavy edge calculation if count is reasonable
                for (let i = 0; i < repoCount; i++) {
                    for (let j = i + 1; j < repoCount; j++) {
                        const r1 = filteredRepos[i];
                        const r2 = filteredRepos[j];

                        // Same Owner
                        if (r1.owner.login === r2.owner.login) {
                            edges.push({ from: r1.id, to: r2.id, color: { color: '#e2e8f0', opacity: 0.5 } });
                            continue;
                        }

                        // Shared Topics (at least 2)
                        const topics1 = r1.topics || [];
                        const topics2 = r2.topics || [];
                        const intersection = topics1.filter(t => topics2.includes(t));

                        if (intersection.length >= 2) {
                            edges.push({ from: r1.id, to: r2.id, color: { color: '#cbd5e1', opacity: 0.3 } });
                        }
                    }
                }
            }

            const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
            const options = {
                nodes: {
                    font: { size: 14, color: '#333' },
                    borderWidth: 2
                },
                physics: {
                    stabilization: false,
                    barnesHut: { gravitationalConstant: -2000, springConstant: 0.04 }
                }
            };

            new vis.Network(container, data, options);

            // Handle click
            // network.on("click", function (params) {
            //    if (params.nodes.length > 0) showDetail(params.nodes[0]);
            // });
        }

        // Filter by Collection
        window.filterByCollection = function (id) {
            currentCollection = id;
            updateCollectionsBar();
            handleFilter();
        };

        window.createNewCollectionFromBar = function () {
            const name = prompt("ÏÉà Ïª¨Î†âÏÖò Ïù¥Î¶Ñ:");
            if (name) {
                StorageManager.createCollection(name);
                updateCollectionsBar();
            }
        };

        // Handle filter
        function handleFilter() {
            const query = filterInput.value.toLowerCase();

            filteredRepos = allRepos.filter(repo => {
                const matchesSearch = !query ||
                    repo.name.toLowerCase().includes(query) ||
                    (repo.description || '').toLowerCase().includes(query) ||
                    (repo.topics || []).some(t => t.toLowerCase().includes(query)) ||
                    (repo.userData?.note || '').toLowerCase().includes(query);

                const matchesCategory = currentCategory === 'all' || repo._category === currentCategory;

                let matchesPurpose = true;
                if (currentPurpose !== 'all') {
                    if (currentPurpose === 'memo') {
                        matchesPurpose = !!repo.userData?.note;
                    } else {
                        matchesPurpose = repo.userData?.purpose === currentPurpose;
                    }
                }

                let matchesCollection = true;
                if (currentCollection !== 'all') {
                    const colIds = repo.userData?.collectionIds || [];
                    matchesCollection = colIds.includes(currentCollection);
                }

                let matchesDecision = true;
                if (currentDecision !== 'all') {
                    if (currentDecision === 'none') {
                        matchesDecision = !repo.userData?.decision_snapshot;
                    } else {
                        matchesDecision = repo.userData?.decision_snapshot === currentDecision;
                    }
                }

                return matchesSearch && matchesCategory && matchesPurpose && matchesCollection && matchesDecision;
            });

            currentPage = 1;
            handleSort();
        }



        // Handle sort
        function handleSort() {
            const sortBy = sortSelect.value;

            filteredRepos.sort((a, b) => {
                switch (sortBy) {
                    case 'stars':
                        return b.stargazers_count - a.stargazers_count;
                    case 'updated':
                        return new Date(b.updated_at) - new Date(a.updated_at);
                    case 'name':
                        return a.name.localeCompare(b.name);
                    default:
                        return 0;
                }
            });

            const displayRepos = filteredRepos.slice(0, displayPerPage);
            renderRepos(displayRepos);

            // Show/hide load more button
            if (filteredRepos.length > displayPerPage) {
                loadMoreSection.classList.add('show');
            } else {
                loadMoreSection.classList.remove('show');
            }
        }

        // Load more
        function loadMore() {
            currentPage++;
            const start = (currentPage - 1) * displayPerPage;
            const end = start + displayPerPage;
            const moreRepos = filteredRepos.slice(start, end);

            renderRepos(moreRepos, true);

            if (end >= filteredRepos.length) {
                loadMoreSection.classList.remove('show');
            }
        }

        // Extract username from input
        function extractUsername(input) {
            input = input.trim();
            const urlMatch = input.match(/github\.com\/([^\/\?]+)/i);
            if (urlMatch) {
                return urlMatch[1];
            }
            return input;
        }

        // Handle search
        async function handleSearch() {
            const rawInput = usernameInput.value.trim();

            if (!rawInput) {
                showError('ÏÇ¨Ïö©ÏûêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }

            const username = extractUsername(rawInput);
            usernameInput.value = username;

            // Save history
            StorageManager.saveSearchHistory(username);
            updateHistoryList();

            // Reset state
            allRepos = [];
            filteredRepos = [];
            currentPage = 1;
            currentCategory = 'all';
            filterInput.value = '';
            sortSelect.value = 'starred_at';

            // Show loading
            hideError();
            emptyState.classList.add('hide');
            reposGrid.classList.remove('show');
            statsSection.classList.remove('show');
            filterSection.classList.remove('show');
            loadMoreSection.classList.remove('show');
            loadingState.classList.add('show');

            try {
                // Fetch stars
                const fetchedRepos = await fetchAllStars(username);

                // Merge with local data
                allRepos = fetchedRepos.map(repo => {
                    const localData = StorageManager.getRepoData(repo.id);
                    return { ...repo, userData: localData };
                });

                if (allRepos.length === 0) {
                    loadingState.classList.remove('show');
                    emptyState.classList.remove('hide');
                    emptyState.innerHTML = `
                        <div class="empty-icon">‚≠ê</div>
                        <h2>StarsÍ∞Ä ÏóÜÏäµÎãàÎã§</h2>
                        <p>${username}ÎãòÏùÄ ÏïÑÏßÅ StarsÌïú Î†àÌè¨ÏßÄÌÜ†Î¶¨Í∞Ä ÏóÜÏäµÎãàÎã§</p>
                    `;
                    return;
                }

                // Analyze
                const stats = analyzeRepos(allRepos);
                filteredRepos = [...allRepos];

                // Update UI
                loadingState.classList.remove('show');
                statsSection.classList.add('show');
                filterSection.classList.add('show');
                reposGrid.classList.add('show');

                updateStats(stats);
                updateCategoryChips(stats.categories);
                updateCollectionsBar(); // Initialize bar

                // Initial render
                const displayRepos = filteredRepos.slice(0, displayPerPage);
                renderRepos(displayRepos);

                if (filteredRepos.length > displayPerPage) {
                    loadMoreSection.classList.add('show');
                }

            } catch (error) {
                loadingState.classList.remove('show');
                emptyState.classList.remove('hide');
                showError(error.message);
            }
        }

        // Show/hide error
        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.classList.add('show');
        }

        function hideError() {
            errorMsg.classList.remove('show');
        }

        // --- AI Analysis Functions ---

        // Render Markdown (Enhanced)
        function renderMarkdown(text) {
            if (!text) return '';

            // 1. Code Blocks
            let html = text.replace(/```(\w+)?\n([\s\S]*?)```/g, function (match, lang, code) {
                return `<div class="code-block">
                            <div class="code-header">${lang || 'Code'} <button onclick="copyCode(this)" class="copy-btn">Copy</button></div>
                            <pre><code>${code.trim()}</code></pre>
                        </div>`;
            });

            // 2. Headings & Formatting
            html = html
                .replace(/^### (.*$)/gim, '<h3 class="md-h3">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="md-h2">$1</h2>')
                .replace(/^# (.*$)/gim, '<h1 class="md-h1">$1</h1>')
                .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*)\*/gim, '<em>$1</em>')
                .replace(/^- (.*$)/gim, '<li>$1</li>')
                .replace(/\n\n/gim, '<br>');

            // Wrap lists
            if (html.includes('<li>')) {
                html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            }

            return `<div class="markdown-prose">${html}</div>`;
        }

        // Safe JSON Parser (with Markdown stripper)
        function safelyParseJSON(text) {
            try {
                // 1. Try direct parse
                return JSON.parse(text);
            } catch (e) {
                // 2. Try stripping markdown code blocks
                const jsonMatch = text.match(/```(?:json)?\s*([\s\S]*?)\s*```/);
                if (jsonMatch && jsonMatch[1]) {
                    try {
                        return JSON.parse(jsonMatch[1]);
                    } catch (e2) {
                        return null; // Failed
                    }
                }
                return null; // Not JSON
            }
        }

        // Render v2 Repo Card (JSON Schema)
        function renderRepoCardJSON(card) {
            if (!card) return '';

            // --- Schema V2: Implementation Engine ---
            if (card.recipe) {
                return `
                <div class="repo-card-v2">
                    <!-- 1. Identity -->
                    <div class="v2-header">
                        <div class="v2-icon">${card.identity.icon || '‚ö°Ô∏è'}</div>
                        <div class="v2-title-area">
                            <h3>${card.identity.name}</h3>
                            <p class="v2-one-liner">${card.identity.desc_one_liner}</p>
                            <div class="v2-tags">
                                ${(card.identity.tags || []).map(t => `<span class="v2-tag">#${t}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- 2. Quick Start (Entrance) -->
                    <div class="v2-section" style="border-left: 4px solid #10b981; background: #f0fdf4;">
                        <h4 style="color:#059669;">‚ö° Quick Start</h4>
                        <div class="v2-code-block">
                            <div style="margin-bottom:8px; color:#9ca3af; font-size:0.8rem;"># Install</div>
                            <div style="margin-bottom:12px; font-weight:bold; color:#fff;">
                                $ ${card.quick_start.install_cmd} 
                                <button class="v2-copy-btn" onclick="navigator.clipboard.writeText('${card.quick_start.install_cmd}')">Copy</button>
                            </div>
                            
                            ${card.quick_start.usage_cmd ? `
                            <div style="border-top:1px solid #374151; margin:8px 0; padding-top:8px;">
                                <div style="color:#9ca3af; font-size:0.8rem;"># Verify</div>
                                <div>$ ${card.quick_start.usage_cmd}</div>
                            </div>` : ''}
                            
                            ${card.quick_start.success_criteria ? `
                            <div style="margin-top:8px; font-size:0.85rem; color:#86efac;">
                                ‚úî Expect: "${card.quick_start.success_criteria}"
                            </div>` : ''}
                        </div>
                    </div>

                    <!-- 3. Integration Recipe (Core) -->
                    <div class="v2-section">
                        <h4>üç≥ Integration Recipe: ${card.recipe.context}</h4>
                        
                        ${(card.recipe.input || card.recipe.process || card.recipe.output) ? `
                        <div style="display:flex; gap:12px; margin-bottom:12px; font-size:0.85rem; background:#f9fafb; padding:12px; border-radius:6px; flex-wrap:wrap; border:1px solid #e5e7eb;">
                             ${card.recipe.input ? `<div style="flex:1; min-width:140px;"><strong>üì• Input</strong><br><span style="color:#4b5563;">${card.recipe.input}</span></div>` : ''}
                             ${card.recipe.process ? `<div style="flex:1; min-width:140px; border-left:1px solid #e5e7eb; padding-left:12px;"><strong>‚öôÔ∏è Process</strong><br><span style="color:#4b5563;">${card.recipe.process}</span></div>` : ''}
                             ${card.recipe.output ? `<div style="flex:1; min-width:140px; border-left:1px solid #e5e7eb; padding-left:12px;"><strong>üì§ Output</strong><br><span style="color:#4b5563;">${card.recipe.output}</span></div>` : ''}
                        </div>` : ''}

                        <div class="v2-code-block">
                            <pre style="margin:0; white-space:pre-wrap;">${card.recipe.code_block}</pre>
                            <button class="v2-copy-btn" onclick="navigator.clipboard.writeText(\`${card.recipe.code_block.replace(/`/g, '\\`')}\`)">Copy Recipe</button>
                        </div>
                        <ol style="margin-top:12px; padding-left:20px; color:#4b5563; font-size:0.9rem;">
                            ${(card.recipe.steps || []).map(s => `<li>${s}</li>`).join('')}
                        </ol>
                    </div>

                    <!-- 4. Reality Check (Pitfalls) -->
                    <div class="v2-section" style="background:#fff1f2; border:1px solid #fecaca;">
                        <h4 style="color:#b91c1c;">‚ö†Ô∏è Reality Check (Pitfalls)</h4>
                        <ul style="color:#991b1b;">
                            ${(card.pitfalls || []).map(p => `<li>${p}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <!-- 5. Outcome -->
                    <div class="v2-section">
                        <h4>üéÅ What You Get</h4>
                        <p style="color:#374151; font-size:0.95rem;">${card.what_you_get}</p>
                    </div>

                    <!-- Meta -->
                    <div class="v2-meta">
                        <span>Confidence: <span class="badge-${card.ai_meta.confidence}">${card.ai_meta.confidence}</span></span>
                        <span>Archited by AI on ${new Date(card.ai_meta.generated_at).toLocaleDateString()}</span>
                    </div>
                </div>`;
            }

            // --- Schema V1: Legacy Fallback ---
            return `
                <div class="repo-card-v2">
                    <div class="v2-header">
                        <div class="v2-icon">${card.identity.icon || 'üì¶'}</div>
                        <div class="v2-title-area">
                            <h3>${card.identity.name}</h3>
                            <p class="v2-one-liner">${card.identity.desc_one_liner}</p>
                            <div class="v2-tags">
                                ${(card.identity.tags || []).map(t => `<span class="v2-tag">#${t}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    ${card.why ? `
                    <div class="v2-section v2-why">
                        <h4>üöÄ Why use this?</h4>
                        <ul>
                            <li><strong>Target:</strong> ${card.why.target_persona}</li>
                            <li><strong>Problem:</strong> ${card.why.problem_solved}</li>
                            <li><strong>Benefit:</strong> ${card.why.core_benefit}</li>
                        </ul>
                    </div>` : ''}

                    ${(card.quick_start && (card.quick_start.install_cmd || card.quick_start.example_code)) ? `
                    <div class="v2-section">
                        <h4>‚ö° Quick Start</h4>
                        <div class="v2-code-block">
                            ${card.quick_start.install_cmd ? `
                                <div style="margin-bottom:8px; color:#9ca3af; font-size:0.8rem;"># Install</div>
                                <div style="margin-bottom:12px;">$ ${card.quick_start.install_cmd} <button class="v2-copy-btn" onclick="navigator.clipboard.writeText('${card.quick_start.install_cmd}')">Copy</button></div>
                            ` : ''}
                            ${card.quick_start.example_code ? `
                                <div style="margin-bottom:8px; color:#9ca3af; font-size:0.8rem;"># Usage</div>
                                <pre style="margin:0; white-space:pre-wrap;">${card.quick_start.example_code}</pre>
                            ` : ''}
                        </div>
                    </div>
                    ` : ''}

                    ${card.usage ? `
                    <div class="v2-grid-section">
                        <div class="v2-col success">
                            <h4>‚úÖ When to use</h4>
                            <ul>${(card.usage.when_to_use || []).map(i => `<li>${i}</li>`).join('')}</ul>
                        </div>
                        <div class="v2-col danger">
                            <h4>üö´ Valid alternatives if...</h4>
                            <ul>${(card.usage.when_not_to_use || []).map(i => `<li>${i}</li>`).join('')}</ul>
                        </div>
                    </div>` : ''}

                    <div class="v2-meta">
                        <span>Confidence: <span class="badge-${card.ai_meta.confidence}">${card.ai_meta.confidence}</span></span>
                        <span>Generated: ${new Date(card.ai_meta.generated_at).toLocaleDateString()}</span>
                    </div>

                    ${card.ai_recommendation ? `
                    <div class="v2-recommendation ${card.ai_recommendation.verdict}">
                        <div class="rec-icon">
                            ${card.ai_recommendation.verdict === 'adopt' ? 'üõ°Ô∏è' : card.ai_recommendation.verdict === 'hold' ? 'üöß' : 'üõë'}
                        </div>
                        <div class="rec-content">
                            <strong>AI Staff Recommendation: <span style="text-transform:uppercase">${card.ai_recommendation.verdict}</span></strong>
                            <p>${card.ai_recommendation.reason}</p>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Render Collections for Repo (in Modal)
        function renderRepoCollections(repoId) {
            const repoCollections = collections.filter(c => c.repoIds.includes(String(repoId)));
            if (repoCollections.length === 0) return '<span style="color:#d1d5db; font-size:0.8rem;">No collections</span>';

            return repoCollections.map(c => `
                <span class="collection-badge" onclick="filterByCollection('${c.id}')">
                    üìÅ ${c.name}
                    <span class="remove-x" onclick="event.stopPropagation(); removeFromCollection('${c.id}', '${repoId}')">&times;</span>
                </span>
            `).join('');
        }

        // Add to Collection from Modal
        window.addToCollectionFromModal = function (repoId) {
            const select = document.getElementById('collectionSelect');
            const collectionId = select.value;
            if (!collectionId) return;

            StorageManager.addRepoToCollection(collectionId, repoId);

            // Refresh
            document.getElementById('repoCollectionList').innerHTML = renderRepoCollections(repoId);
            select.value = ''; // Reset
        };

        // Remove from Collection
        window.removeFromCollection = function (collectionId, repoId) {
            StorageManager.removeRepoFromCollection(collectionId, repoId);
            // Refresh if in modal
            const listEl = document.getElementById('repoCollectionList');
            if (listEl) {
                listEl.innerHTML = renderRepoCollections(repoId);
            }
        };

        // Render User Data Section (Hybrid)
        function renderUserDataSection(repo) {
            const userData = repo.userData || {};
            const purposeValue = userData.purpose || '';
            const noteValue = userData.note || '';
            let decisionValue = userData.decision_snapshot || '';

            // Migration Mapping
            if (decisionValue === 'adopt') decisionValue = 'use_now';
            if (decisionValue === 'hold') decisionValue = 'reference';
            if (decisionValue === 'avoid') decisionValue = 'archive';

            // Check formatted AI data
            let aiContent = '';
            const aiData = userData.aiSummary;

            if (aiData) {
                // Determine format
                if (typeof aiData === 'object' && aiData.identity) {
                    // v2 JSON Format
                    aiContent = renderRepoCardJSON(aiData);
                } else if (typeof aiData === 'string') {
                    // Legacy Markdown Format
                    aiContent = renderMarkdown(aiData);
                }
            }

            return `
                <div class="user-data-section">
                    <!-- Implementation Snapshot (Action Buttons) -->
                    <div class="decision-toggle-group">
                        <label class="decision-label" style="display:flex; justify-content:space-between; align-items:center;">
                            <span>Implementation Snapshot</span>
                            <span style="font-size:0.8rem; color:#6b7280; font-weight:normal;">What will you do?</span>
                        </label>
                        <div class="toggle-container implementation-actions">
                            <button class="d-btn use_now ${decisionValue === 'use_now' ? 'active' : ''}" onclick="saveDecision('${repo.id}', 'use_now')" title="Deploy Immediately">üöÄ Use Now</button>
                            <button class="d-btn integrate ${decisionValue === 'integrate' ? 'active' : ''}" onclick="saveDecision('${repo.id}', 'integrate')" title="Plan Needed">üèó Integrate</button>
                            <button class="d-btn reference ${decisionValue === 'reference' ? 'active' : ''}" onclick="saveDecision('${repo.id}', 'reference')" title="Study Later">üìö Reference</button>
                            <button class="d-btn archive ${decisionValue === 'archive' ? 'active' : ''}" onclick="saveDecision('${repo.id}', 'archive')" title="Not for me">üì¶ Archive</button>
                        </div>
                    </div>

                    <h3>My Data</h3>
                    <div class="form-group">
                        <label>Target Project</label>
                        <select id="repoPurpose" class="form-control">
                            <option value="">Where will you use this?</option>
                            <option value="reference" ${purposeValue === 'reference' ? 'selected' : ''}>üìö Reference (ÎÇòÏ§ëÏóê Ï∞∏Í≥†)</option>
                            <option value="to-try" ${purposeValue === 'to-try' ? 'selected' : ''}>üß™ To Try (Ïç®Î¥êÏïº Ìï®)</option>
                            <option value="idea" ${purposeValue === 'idea' ? 'selected' : ''}>üí° Idea Source (ÏòÅÍ∞ê ÏñªÍ∏∞)</option>
                            <option value="alternative" ${purposeValue === 'alternative' ? 'selected' : ''}>üîÑ Alternative (ÎåÄÏïà Í∏∞Ïà†)</option>
                            <option value="using" ${purposeValue === 'using' ? 'selected' : ''}>üõ† Using (ÏÇ¨Ïö© Ï§ë)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>One-line Note</label>
                        <input type="text" id="repoNote" class="form-control" value="${noteValue}" placeholder="Ïôú Ïù¥ Î†àÌè¨Î•º Ï†ÄÏû•ÌñàÎÇòÏöî? (Ïòà: Îã§Ïùå ÌîÑÎ°úÏ†ùÌä∏ Ï∞®Ìä∏ ÎùºÏù¥Î∏åÎü¨Î¶¨ ÌõÑÎ≥¥)">
                    </div>

                    <div style="text-align:right; margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="saveRepoData('${repo.id}')">Save Status</button>
                    </div>

                    <!-- Collections UI -->
                    <div class="collections-ui-block" style="border-top: 1px solid #eee; padding-top: 20px; margin-bottom: 20px;">
                         <h4>üìÅ Collections</h4>
                         <div id="repoCollectionList" style="margin-bottom:10px;">
                            ${renderRepoCollections(repo.id)}
                         </div>
                         <div style="display:flex; gap:10px;">
                             <select id="collectionSelect" class="form-control">
                                 <option value="">Select Collection...</option>
                                 ${collections.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                             </select>
                             <button class="btn btn-secondary" onclick="addToCollectionFromModal('${repo.id}')">Add</button>
                         </div>
                    </div>

                    <!-- AI Section -->
                    <div class="ai-section" id="aiHeader-${repo.id}">
                        ${aiData ? `
                            <div class="ai-title">‚ú® AI Insight ¬∑ Tech Decision Card</div>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <button class="ai-btn" onclick="generateAISummary('${repo.id}')" id="aiBtn-${repo.id}">üîÑ Re-Analyze</button>
                            </div>
                        ` : `
                            <button class="ai-btn" onclick="generateAISummary('${repo.id}')" id="aiBtn-${repo.id}">‚ú® Analyze with AI</button>
                        `}
                    </div>
                    <div id="aiContent-${repo.id}" class="ai-content">
                        ${aiContent}
                    </div>
                </div>
            `;
        }

        // Copy Code Utility
        window.copyCode = function (btn) {
            const code = btn.parentElement.nextElementSibling.innerText;
            navigator.clipboard.writeText(code);
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 2000);
        };

        window.generateAISummary = async function (repoId) {
            const btn = document.getElementById(`aiBtn-${repoId}`);
            const contentDiv = document.getElementById(`aiContent-${repoId}`);
            const repo = allRepos.find(r => r.id == repoId);

            if (!repo) return;

            // 1. Check API Key & Provider
            const provider = StorageManager.getProvider(); // 'gemini' or 'deepseek'
            let apiKey;

            if (provider === 'deepseek') {
                apiKey = StorageManager.getDeepSeekKey();
            } else {
                apiKey = StorageManager.getApiKey();
            }

            if (!apiKey) {
                alert(`${provider === 'deepseek' ? 'DeepSeek' : 'Google Gemini'} API KeyÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§. ÏÑ§Ï†ïÏóêÏÑú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.`);
                openSettings();
                return;
            }

            // 2. UI - Loading State
            const originalBtnText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="spinner-sm"></span> Î∂ÑÏÑù Ï§ë...`;

            contentDiv.innerHTML = `
                <div class="ai-loading">
                    <div class="spinner" style="margin: 0 auto 10px auto;"></div>
                    <p id="aiStatusText" style="font-size:0.9rem;">AIÍ∞Ä Î†àÌè¨ÏßÄÌÜ†Î¶¨Î•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...</p>
                </div>
            `;

            try {
                // 3. Prepare Prompt (Refined)
                // 3. Prepare Prompt (v4: Implementation Architect)
                const prompt = `
                ÎãπÏã†ÏùÄ "Senior Integration Architect"ÏûÖÎãàÎã§. Ïù¥ ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÎÇ¥ ÌîÑÎ°úÏ†ùÌä∏Ïóê **2Î∂Ñ ÏïàÏóê ÌÜµÌï©(Integration)**ÌïòÎ†§Î©¥ Ïñ¥ÎñªÍ≤å Ìï¥Ïïº ÌïòÎäîÏßÄ "Ïã§Ìñâ Î†àÏãúÌîº"Î•º ÏûëÏÑ±ÌïòÏã≠ÏãúÏò§.
                ÌèâÍ∞ÄÎÇò Î¶¨Î∑∞Îäî ÌïÑÏöî ÏóÜÏäµÎãàÎã§. Ïò§ÏßÅ **Ïã§Ìñâ Í∞ÄÎä•Ìïú ÏΩîÎìú**ÏôÄ **ÌÜµÌï© Í∞ÄÏù¥Îìú**Ïóê ÏßëÏ§ëÌïòÏã≠ÏãúÏò§.
                Î∞òÎìúÏãú **JSON Ìè¨Îß∑**ÏúºÎ°úÎßå ÏùëÎãµÌï¥Ïïº Ìï©ÎãàÎã§.

                [Î∂ÑÏÑù ÎåÄÏÉÅ]
                Repository: ${repo.name}
                Description: ${repo.description || 'N/A'}
                Language: ${repo.language || 'N/A'}
                Topics: ${(repo.topics || []).join(', ')}

                [JSON Schema Definition]
                {
                  "identity": {
                    "name": "Ìå®ÌÇ§ÏßÄÎ™Ö (ÎåÄÏÜåÎ¨∏Ïûê Ï†ïÌôïÌûà)",
                    "desc_one_liner": "Ïù¥ ÎèÑÍµ¨Ïùò ÌïµÏã¨ Í∏∞Îä•Í≥º Í∞ÄÏπòÎ•º ÌïúÍµ≠Ïñ¥Î°ú Ìïú Ï§Ñ Ï†ïÏùò (Î™ÖÏÇ¨Ìòï Ï¢ÖÍ≤∞)",
                    "tags": ["ÌïµÏã¨ÌÇ§ÏõåÎìú1", "ÌïµÏã¨ÌÇ§ÏõåÎìú2"],
                    "icon": "Í¥ÄÎ†® Ïù¥Î™®ÏßÄ 1Í∞ú (Ïòà: ‚ö°Ô∏è)"
                  },
                  "quick_start": {
                    "install_cmd": "ÏÑ§Ïπò Î™ÖÎ†πÏñ¥ (Ïòà: npm install package)",
                    "usage_cmd": "Í≤ÄÏ¶ùÏö© Ïã§Ìñâ Î™ÖÎ†πÏñ¥ (Optional)",
                    "success_criteria": "ÏÑ§Ïπò ÏÑ±Í≥µ Ïãú ÌôïÏù∏Ìï¥Ïïº Ìï† Ï∂úÎ†• Î©îÏãúÏßÄ ÏòàÏãú"
                  },
                  "recipe": {
                    "context": "ÌÜµÌï© Î†àÏù¥Ïñ¥ (Ïòà: React Component, FastAPI Middleware)",
                    "input": "ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞ (Ïòà: Claude Code Plan JSON)",
                    "process": "ÌïµÏã¨ Î°úÏßÅ (Ïòà: Node/Edge ÌååÏã± Î∞è Î†àÏù¥ÏïÑÏõÉ)",
                    "output": "ÏµúÏ¢Ö Ï∂úÎ†• (Ïòà: Interactive Mermaid Diagram)",
                    "code_block": "Î≥µÏÇ¨Ìï¥ÏÑú Î∞îÎ°ú Ïã§Ìñâ Í∞ÄÎä•Ìïú Minimal Working Example (importÎ∂ÄÌÑ∞ ÏãúÏûë)",
                    "steps": ["Îã®Í≥Ñ 1: ÏÑ§Ïπò", "Îã®Í≥Ñ 2: ÏÑ§Ï†ï", "Îã®Í≥Ñ 3: Ïã§Ìñâ"]
                  },
                  "pitfalls": ["ÏÇ¨Ïö© Ïãú Ï£ºÏùòÌï¥Ïïº Ìï† ÏÑ±Îä•/Î≥¥Ïïà/ÌôòÍ≤Ω Ï†úÏïΩÏÇ¨Ìï≠ (3Í∞ú Ïù¥ÎÇ¥)"],
                  "what_you_get": "Ïù¥Í±∏ Ï†ÅÏö©ÌïòÎ©¥ ÎÇ¥ ÏÑúÎπÑÏä§Ïóê ÏÉùÍ∏∞Îäî Íµ¨Ï≤¥Ï†Å Í≤∞Í≥ºÎ¨º (Ïòà: Ïù∏ÌÑ∞ÎûôÌã∞Î∏å Í∑∏ÎûòÌîÑ Ïª¥Ìè¨ÎÑåÌä∏)",
                  "ai_meta": {
                     "confidence": "high" | "medium" | "low",
                     "generated_at": "${new Date().toISOString()}"
                  }
                }

                [ÏûëÏÑ± ÏõêÏπô]
                1. ÌïúÍµ≠Ïñ¥Î°ú ÏûëÏÑ±ÌïòÎêò, ÏΩîÎìúÎäî ÏõêÎ¨∏ Ïú†ÏßÄ.
                2. 'recipe.code_block'ÏùÄ Ïã§Ï†ú Ïã§Ìñâ Í∞ÄÎä•Ìï¥Ïïº Ìï®.
                3. 'pitfalls'Îäî ÏπòÎ™ÖÏ†ÅÏù∏ Ï†úÏïΩÏÇ¨Ìï≠ ÏúÑÏ£ºÎ°ú ÏûëÏÑ±.
                `;

                // 4. Update Status Text
                const statusTimer1 = setTimeout(() => {
                    const status = document.getElementById('aiStatusText');
                    if (status) status.textContent = "ÎùºÏù¥Î∏åÎü¨Î¶¨ Ïª®ÌÖçÏä§Ìä∏ Ïù¥Ìï¥ Ï§ë...";
                }, 1500);

                const statusTimer2 = setTimeout(() => {
                    const status = document.getElementById('aiStatusText');
                    if (status) status.textContent = "Ïã§Ìñâ Í∞ÄÎä•Ìïú ÏòàÏ†ú ÏÉùÏÑ± Ï§ë...";
                }, 3500);

                // 5. Call API
                let result = "";
                if (provider === 'deepseek') {
                    result = await callDeepSeekAPI(apiKey, prompt);
                } else {
                    result = await callGeminiAPI(apiKey, prompt);
                }

                clearTimeout(statusTimer1);
                clearTimeout(statusTimer2);

                // 6. Save & Render
                repo.userData = repo.userData || {};

                // Parse JSON if possible
                const jsonResult = safelyParseJSON(result);
                const finalData = jsonResult || result; // Fallback to raw text if parse fails

                // IMPORTANT: Ensure deep merge or assignment
                repo.userData.aiSummary = finalData;
                repo.userData.aiProvider = provider;

                // Persist immediately
                StorageManager.updateRepoData(repoId, {
                    aiSummary: finalData,
                    aiProvider: provider
                });

                // Add success visual
                const modalBody = document.querySelector('.modal-body');
                if (modalBody) {
                    const successToast = document.createElement('div');
                    successToast.style.cssText = "position:absolute; top:10px; right:10px; background:#10b981; color:white; padding:4px 12px; border-radius:12px; font-size:0.8rem; opacity:0; transition:opacity 0.5s;";
                    successToast.textContent = "Saved ‚úì";
                    modalBody.style.position = 'relative'; // Ensure modal-body is positioned for absolute child
                    modalBody.appendChild(successToast);
                    setTimeout(() => successToast.style.opacity = '1', 100);
                    setTimeout(() => successToast.remove(), 2000);
                }

                // Render Content
                if (typeof finalData === 'object') {
                    contentDiv.innerHTML = renderRepoCardJSON(finalData);
                } else {
                    contentDiv.innerHTML = renderMarkdown(finalData);
                }

                // Add Footer
                contentDiv.innerHTML += `
                < div style = "margin-top:15px; padding-top:10px; border-top:1px dashed #e5e7eb; display:flex; justify-content:space-between; align-items:center; font-size:0.75rem; color:#6b7280;" >
                        <span>‚ö†Ô∏è AI Î∂ÑÏÑù Í≤∞Í≥ºÎäî Ï∂îÏ†ïÏπòÏù¥Î©∞ Ï†ïÌôïÌïòÏßÄ ÏïäÏùÑ Ïàò ÏûàÏäµÎãàÎã§.</span>
                        <span style="background:#f3f4f6; padding:2px 8px; border-radius:12px;">
                            Generated by ${provider === 'deepseek' ? 'DeepSeek üêã' : 'Gemini ‚ú®'}
                        </span>
                    </div >
                `;

                // Refresh badge
                document.getElementById(`aiHeader - ${repoId} `).innerHTML = `
                < div class="ai-title" >‚ú® AI Insight ¬∑ Tech Decision Card</div >
                    <div style="display:flex; align-items:center; gap:8px;">
                        <button class="ai-btn" onclick="generateAISummary('${repo.id}')" id="aiBtn-${repo.id}">üîÑ Re-Analyze</button>
                    </div>
            `;

            } catch (error) {
                console.error(error);
                let errorMsg = "Î∂ÑÏÑùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.";
                if (error.message.includes("401")) errorMsg = "API KeyÍ∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.";
                if (error.message.includes("429")) errorMsg = "API ÏöîÏ≤≠ ÌïúÎèÑÎ•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.";

                contentDiv.innerHTML = `< div class="error-msg" style = "display:block;" > ${errorMsg} <br><small>${error.message}</small></div>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalBtnText;
            }
        };

        async function callGeminiAPI(key, prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            });
            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                throw new Error(`Gemini Error (${response.status}): ${err.error?.message || response.statusText}`);
            }
            const data = await response.json();
            if (!data.candidates || !data.candidates[0].content) {
                throw new Error("AI ÏùëÎãµÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§. (Safety blocked potentially)");
            }
            return data.candidates[0].content.parts[0].text;
        }

        async function callDeepSeekAPI(key, prompt) {
            const url = 'https://api.deepseek.com/chat/completions';
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${key}`
                },
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [
                        { "role": "system", "content": "You are a helpful technical assistant." },
                        { "role": "user", "content": prompt }
                    ],
                    stream: false
                })
            });
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`DeepSeek Error (${response.status}): ${errorData.error?.message || response.statusText}`);
            }
            const data = await response.json();
            return data.choices[0].message.content;
        }

    </script>
</body>

</html>